<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard | Intelli-Read</title>
    <link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
    <style>
        * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
          font-family: "Chakra Petch", sans-serif;
        }

        :root {
          --primary: #4361ee;
          --secondary: #3a0ca3;
          --success: #4cc9f0;
          --warning: #f72585;
          --info: #7209b7;
          --dark: #2b2d42;
          --light: #f8f9fa;
          --gray: #6c757d;
          --border: #e9ecef;
        }

        body {
          background: #f5f7fb;
          color: var(--dark);
          overflow-x: hidden;
        }

        /* Header */
        .admin-header {
          background: linear-gradient(135deg, var(--primary), var(--secondary));
          color: white;
          padding: 1rem 2rem;
          box-shadow: 0 2px 10px rgba(0,0,0,0.1);
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          z-index: 1000;
        }

        .header-content {
          display: flex;
          justify-content: space-between;
          align-items: center;
        }

        .header-left h1 {
          font-size: 1.5rem;
          font-weight: 600;
        }

        .admin-info {
          display: flex;
          align-items: center;
          gap: 1rem;
        }

        .logout-btn {
          background: linear-gradient(135deg, #df1e1e, #ff6b6b);
          color: white;
          border: none;
          padding: 10px 20px;
          border-radius: 6px;
          cursor: pointer;
          font-weight: 500;
          transition: all 0.3s ease;
          display: flex;
          align-items: center;
          gap: 8px;
        }

        .logout-btn:hover {
          background: linear-gradient(135deg, #ee5a52, #e53e3e);
          transform: translateY(-2px);
          box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
        }

        /* Main Container */
        .admin-container {
          display: flex;
          margin-top: 70px;
          min-height: calc(100vh - 70px);
        }

        /* Sidebar */
        .sidebar {
          width: 260px;
          background: white;
          box-shadow: 2px 0 10px rgba(0,0,0,0.1);
          height: calc(100vh - 70px);
          position: fixed;
          overflow-y: auto;
        }

        .sidebar-header {
          padding: 2rem 1.5rem;
          border-bottom: 1px solid var(--border);
        }

        .sidebar-header h2 {
          color: var(--primary);
          font-size: 1.3rem;
        }

        .sidebar-menu {
          list-style: none;
          padding: 1rem 0;
        }

        .menu-item {
          padding: 1rem 1.5rem;
          display: flex;
          align-items: center;
          gap: 1rem;
          cursor: pointer;
          transition: all 0.3s ease;
          border-left: 3px solid transparent;
        }

        .menu-item:hover {
          background: #f8f9fa;
          color: var(--primary);
        }

        .menu-item.active {
          background: linear-gradient(90deg, rgba(67, 97, 238, 0.1), transparent);
          color: var(--primary);
          border-left-color: var(--primary);
        }

        .menu-item i {
          font-size: 1.2rem;
        }

        /* Main Content */
        .main-content {
          flex: 1;
          margin-left: 260px;
          padding: 2rem;
        }

        .section {
          display: none;
        }

        .section.active {
          display: block;
          animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
          from { opacity: 0; transform: translateY(20px); }
          to { opacity: 1; transform: translateY(0); }
        }

        .section-header {
          margin-bottom: 2rem;
        }

        .section-header h1 {
          font-size: 2rem;
          color: var(--dark);
          margin-bottom: 0.5rem;
        }

        .section-header p {
          color: var(--gray);
        }

        .header-actions {
          display: flex;
          gap: 1rem;
          align-items: center;
          margin-top: 1rem;
        }

        /* Stats Grid */
        .stats-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
          gap: 1.5rem;
          margin-bottom: 2rem;
        }

        .stat-card {
          background: white;
          padding: 1.5rem;
          border-radius: 12px;
          box-shadow: 0 4px 6px rgba(0,0,0,0.05);
          display: flex;
          align-items: center;
          gap: 1rem;
          transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .stat-card:hover {
          transform: translateY(-5px);
          box-shadow: 0 8px 15px rgba(0,0,0,0.1);
        }

        .stat-card.primary { border-left: 4px solid var(--primary); }
        .stat-card.success { border-left: 4px solid var(--success); }
        .stat-card.warning { border-left: 4px solid var(--warning); }
        .stat-card.info { border-left: 4px solid var(--info); }
        .stat-card.secondary { border-left: 4px solid #6c757d; }
        .stat-card.danger { border-left: 4px solid #dc3545; }

        .stat-icon {
          width: 60px;
          height: 60px;
          border-radius: 12px;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 1.5rem;
          color: white;
        }

        .stat-card.primary .stat-icon { background: var(--primary); }
        .stat-card.success .stat-icon { background: var(--success); }
        .stat-card.warning .stat-icon { background: var(--warning); }
        .stat-card.info .stat-icon { background: var(--info); }
        .stat-card.secondary .stat-icon { background: #6c757d; }
        .stat-card.danger .stat-icon { background: #dc3545; }

        .stat-info h3 {
          font-size: 2rem;
          margin-bottom: 0.5rem;
        }

        .stat-info p {
          color: var(--gray);
          font-size: 0.9rem;
        }

        /* Search Box */
        .search-box {
          position: relative;
          flex: 1;
          max-width: 300px;
        }

        .search-box i {
          position: absolute;
          left: 1rem;
          top: 50%;
          transform: translateY(-50%);
          color: var(--gray);
        }

        .search-box input {
          width: 100%;
          padding: 0.75rem 1rem 0.75rem 2.5rem;
          border: 1px solid var(--border);
          border-radius: 8px;
          outline: none;
          transition: border-color 0.3s ease;
        }

        .search-box input:focus {
          border-color: var(--primary);
        }

        /* Buttons */
        .btn-primary {
          background: var(--primary);
          color: white;
          border: none;
          padding: 0.75rem 1.5rem;
          border-radius: 8px;
          cursor: pointer;
          display: flex;
          align-items: center;
          gap: 0.5rem;
          transition: all 0.3s ease;
        }

        .btn-primary:hover {
          background: var(--secondary);
          transform: translateY(-2px);
        }

        /* Enhanced Button Styles */
        .btn-success {
          background: linear-gradient(135deg, #28a745, #20c997);
          color: white;
          border: none;
          padding: 8px 16px;
          border-radius: 6px;
          cursor: pointer;
          font-weight: 500;
          transition: all 0.3s ease;
          display: inline-flex;
          align-items: center;
          gap: 6px;
          margin: 0 4px;
        }

        .btn-success:hover {
          background: linear-gradient(135deg, #218838, #1e7e34);
          transform: translateY(-2px);
          box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
        }

        .btn-danger {
          background: linear-gradient(135deg, #dc3545, #e83e8c);
          color: white;
          border: none;
          padding: 8px 16px;
          border-radius: 6px;
          cursor: pointer;
          font-weight: 500;
          transition: all 0.3s ease;
          display: inline-flex;
          align-items: center;
          gap: 6px;
          margin: 0 4px;
        }

        .btn-danger:hover {
          background: linear-gradient(135deg, #c82333, #d91a7a);
          transform: translateY(-2px);
          box-shadow: 0 4px 12px rgba(220, 53, 69, 0.3);
        }

        .btn-info {
          background: linear-gradient(135deg, #17a2b8, #6f42c1);
          color: white;
          border: none;
          padding: 8px 16px;
          border-radius: 6px;
          cursor: pointer;
          font-weight: 500;
          transition: all 0.3s ease;
          display: inline-flex;
          align-items: center;
          gap: 6px;
          margin: 0 4px;
        }

        .btn-info:hover {
          background: linear-gradient(135deg, #138496, #5a2d9c);
          transform: translateY(-2px);
          box-shadow: 0 4px 12px rgba(23, 162, 184, 0.3);
        }

        .btn-warning {
          background: linear-gradient(135deg, #ffc107, #fd7e14);
          color: white;
          border: none;
          padding: 8px 16px;
          border-radius: 6px;
          cursor: pointer;
          font-weight: 500;
          transition: all 0.3s ease;
          display: inline-flex;
          align-items: center;
          gap: 6px;
          margin: 0 4px;
        }

        .btn-warning:hover {
          background: linear-gradient(135deg, #e0a800, #e55a00);
          transform: translateY(-2px);
          box-shadow: 0 4px 12px rgba(255, 193, 7, 0.3);
        }

        .btn-secondary {
          background: linear-gradient(135deg, #6c757d, #495057);
          color: white;
          border: none;
          padding: 8px 16px;
          border-radius: 6px;
          cursor: pointer;
          font-weight: 500;
          transition: all 0.3s ease;
          display: inline-flex;
          align-items: center;
          gap: 6px;
          margin: 0 4px;
        }

        .btn-secondary:hover {
          background: linear-gradient(135deg, #5a6268, #343a40);
          transform: translateY(-2px);
          box-shadow: 0 4px 12px rgba(108, 117, 125, 0.3);
        }

        .action-buttons {
          display: flex;
          gap: 8px;
          flex-wrap: wrap;
        }

        /* Tables */
        .table-container {
          background: white;
          border-radius: 12px;
          box-shadow: 0 4px 6px rgba(0,0,0,0.05);
          overflow: hidden;
        }

        table {
          width: 100%;
          border-collapse: collapse;
        }

        th, td {
          padding: 1rem;
          text-align: left;
          border-bottom: 1px solid var(--border);
        }

        th {
          background: #f8f9fa;
          font-weight: 600;
          color: var(--dark);
        }

        tr:hover {
          background: #f8f9fa;
        }

        /* Status Badges */
        .status-badge {
          padding: 0.3rem 0.8rem;
          border-radius: 20px;
          font-size: 0.8rem;
          font-weight: 500;
        }

        .status-pending { background: #fff3cd; color: #856404; }
        .status-approved { background: #d1edff; color: #004085; }
        .status-rejected { background: #f8d7da; color: #721c24; }
        .status-active { background: #d4edda; color: #155724; }
        .status-inactive { background: #e2e3e5; color: #383d41; }

        /* Pagination */
        .pagination {
          display: flex;
          justify-content: center;
          align-items: center;
          gap: 0.5rem;
          margin-top: 2rem;
        }

        .pagination button {
          padding: 0.5rem 1rem;
          border: 1px solid var(--border);
          background: white;
          cursor: pointer;
          border-radius: 6px;
          transition: all 0.3s ease;
        }

        .pagination button.active {
          background: var(--primary);
          color: white;
          border-color: var(--primary);
        }

        .pagination button:hover:not(.active) {
          background: #f8f9fa;
        }

        /* Modal */
        .modal {
          display: none;
          position: fixed;
          z-index: 2000;
          left: 0;
          top: 0;
          width: 100%;
          height: 100%;
          background: rgba(0,0,0,0.5);
        }

        .modal-content {
          background: white;
          margin: 5% auto;
          padding: 2rem;
          border-radius: 12px;
          width: 90%;
          max-width: 500px;
          position: relative;
          animation: modalSlide 0.3s ease;
        }

        .modal-content.large {
          max-width: 700px;
        }

        @keyframes modalSlide {
          from { transform: translateY(-50px); opacity: 0; }
          to { transform: translateY(0); opacity: 1; }
        }

        .close {
          position: absolute;
          right: 1rem;
          top: 1rem;
          font-size: 1.5rem;
          cursor: pointer;
          color: var(--gray);
        }

        .close:hover {
          color: var(--dark);
        }

        /* Activity Section */
        .activity-section {
          background: white;
          border-radius: 12px;
          padding: 1.5rem;
          box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        .activity-list {
          margin-top: 1rem;
        }

        .activity-item {
          display: flex;
          align-items: center;
          gap: 1rem;
          padding: 1rem 0;
          border-bottom: 1px solid var(--border);
        }

        .activity-item:last-child {
          border-bottom: none;
        }

        .activity-icon {
          width: 40px;
          height: 40px;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          color: white;
        }

        .activity-icon.user { background: var(--primary); }
        .activity-icon.book { background: var(--success); }
        .activity-icon.system { background: var(--warning); }

        /* Analytics Grid */
        .analytics-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
          gap: 1.5rem;
        }

        .chart-card {
          background: white;
          padding: 1.5rem;
          border-radius: 12px;
          box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        .chart-placeholder {
          height: 300px;
          background: #f8f9fa;
          border-radius: 8px;
          display: flex;
          align-items: center;
          justify-content: center;
          color: var(--gray);
          margin-top: 1rem;
        }

        /* Settings */
        .settings-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
          gap: 1.5rem;
        }

        .setting-card {
          background: white;
          padding: 1.5rem;
          border-radius: 12px;
          box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        .setting-item {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 1rem 0;
          border-bottom: 1px solid var(--border);
        }

        .setting-item:last-child {
          border-bottom: none;
        }

        .setting-item label {
          font-weight: 500;
        }

        .setting-item input {
          padding: 0.5rem;
          border: 1px solid var(--border);
          border-radius: 6px;
          width: 200px;
        }

        /* Switch */
        .switch {
          position: relative;
          display: inline-block;
          width: 50px;
          height: 24px;
        }

        .switch input {
          opacity: 0;
          width: 0;
          height: 0;
        }

        .slider {
          position: absolute;
          cursor: pointer;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background: #ccc;
          transition: .4s;
          border-radius: 24px;
        }

        .slider:before {
          position: absolute;
          content: "";
          height: 16px;
          width: 16px;
          left: 4px;
          bottom: 4px;
          background: white;
          transition: .4s;
          border-radius: 50%;
        }

        input:checked + .slider {
          background: var(--primary);
        }

        input:checked + .slider:before {
          transform: translateX(26px);
        }

        /* Book cover styles */
        .book-cover {
          width: 40px;
          height: 60px;
          object-fit: cover;
          border-radius: 4px;
        }

        .book-cover-placeholder {
          width: 40px;
          height: 60px;
          background: #f8f9fa;
          border-radius: 4px;
          display: flex;
          align-items: center;
          justify-content: center;
          color: #6c757d;
        }

        /* Loading states */
        .loading-cell {
          text-align: center;
          padding: 2rem;
          color: var(--gray);
        }

        .loading-spinner {
          width: 30px;
          height: 30px;
          border: 3px solid #f3f3f3;
          border-top: 3px solid var(--primary);
          border-radius: 50%;
          animation: spin 1s linear infinite;
          margin: 0 auto 1rem;
        }

        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }

        .no-data {
          text-align: center;
          padding: 3rem;
          color: var(--gray);
        }

        .no-data i {
          font-size: 3rem;
          margin-bottom: 1rem;
          display: block;
        }

        /* User avatar */
        .user-avatar {
          display: flex;
          align-items: center;
          gap: 10px;
        }

        .user-avatar i {
          width: 32px;
          height: 32px;
          background: var(--primary);
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          color: white;
        }

        /* Category tags */
        .category-tag {
          background: #e9ecef;
          color: #495057;
          padding: 4px 8px;
          border-radius: 12px;
          font-size: 0.8rem;
          font-weight: 500;
        }

        /* Featured badge */
        .featured-badge {
          background: linear-gradient(135deg, #ffd700, #ffed4e);
          color: #856404;
          padding: 2px 6px;
          border-radius: 8px;
          font-size: 0.7rem;
          font-weight: 600;
          margin-left: 8px;
        }

        /* Book title styling */
        .book-title {
          display: flex;
          align-items: center;
          gap: 8px;
        }

        /* Modal improvements */
        .user-detail-grid {
          display: grid;
          gap: 1rem;
          margin-bottom: 1.5rem;
        }

        .user-detail {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 0.5rem 0;
          border-bottom: 1px solid var(--border);
        }

        .user-detail:last-child {
          border-bottom: none;
        }

        .user-detail label {
          font-weight: 600;
          color: var(--dark);
        }

        .role-badge {
          padding: 4px 8px;
          border-radius: 12px;
          font-size: 0.8rem;
          font-weight: 500;
          background: #e9ecef;
          color: #495057;
        }

        .role-badge.publisher {
          background: #d1edff;
          color: #004085;
        }

        .modal-actions {
          display: flex;
          gap: 1rem;
          justify-content: flex-end;
          margin-top: 1.5rem;
          padding-top: 1.5rem;
          border-top: 1px solid var(--border);
        }

        /* Book Modal Styles */
        .book-detail-grid {
          display: grid;
          grid-template-columns: 200px 1fr;
          gap: 2rem;
          margin-bottom: 1.5rem;
        }

        .book-cover-large img {
          max-width: 100%;
          border-radius: 8px;
          box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .book-info h3 {
          font-size: 1.5rem;
          margin-bottom: 0.5rem;
          color: var(--dark);
        }

        .book-author {
          color: var(--gray);
          font-size: 1.1rem;
          margin-bottom: 1rem;
        }

        .book-meta {
          margin-bottom: 1rem;
        }

        .book-description {
          margin-bottom: 1.5rem;
        }

        .book-description h4 {
          margin-bottom: 0.5rem;
          color: var(--dark);
        }

        .book-stats {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 0.5rem;
        }

        .stat {
          display: flex;
          justify-content: space-between;
          padding: 0.5rem 0;
          border-bottom: 1px solid var(--border);
        }

        .stat:last-child {
          border-bottom: none;
        }

        /* Notification system */
        .notification {
          position: fixed;
          top: 20px;
          right: 20px;
          padding: 15px 20px;
          border-radius: 8px;
          color: white;
          font-weight: 500;
          z-index: 10000;
          box-shadow: 0 4px 12px rgba(0,0,0,0.3);
          max-width: 300px;
          transform: translateX(400px);
          opacity: 0;
          transition: all 0.3s ease;
        }

        .notification.show {
          transform: translateX(0);
          opacity: 1;
        }

        .notification.success {
          background: linear-gradient(135deg, #28a745, #20c997);
        }

        .notification.error {
          background: linear-gradient(135deg, #dc3545, #e83e8c);
        }

        .notification.warning {
          background: linear-gradient(135deg, #ffc107, #fd7e14);
        }

        .notification.info {
          background: linear-gradient(135deg, #17a2b8, #6f42c1);
        }

        .notification-content {
          display: flex;
          align-items: center;
          gap: 10px;
        }

        .notification-content i {
          font-size: 1.2rem;
        }

        /* Loading Overlay */
        .loading-overlay {
          display: none;
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0,0,0,0.7);
          z-index: 9999;
          justify-content: center;
          align-items: center;
          flex-direction: column;
          color: white;
        }

        .loading-overlay.active {
          display: flex;
        }

        .loading-overlay .spinner {
          width: 50px;
          height: 50px;
          border: 5px solid #f3f3f3;
          border-top: 5px solid var(--primary);
          border-radius: 50%;
          animation: spin 1s linear infinite;
          margin-bottom: 15px;
        }

        /* Logout Confirmation Modal */
        .logout-modal {
          background: white;
          border-radius: 12px;
          padding: 2rem;
          text-align: center;
          width: 400px;
          max-width: 90%;
          box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .logout-modal h2 {
          color: var(--dark);
          margin-bottom: 1rem;
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 10px;
        }

        .logout-modal p {
          color: var(--gray);
          margin-bottom: 2rem;
          font-size: 1.1rem;
        }

        .logout-modal-actions {
          display: flex;
          gap: 1rem;
          justify-content: center;
        }

        .logout-modal .btn {
          padding: 12px 24px;
          border: none;
          border-radius: 8px;
          font-weight: 600;
          cursor: pointer;
          transition: all 0.3s ease;
          min-width: 120px;
        }

        .logout-modal .btn-confirm {
          background: linear-gradient(135deg, #dc3545, #e83e8c);
          color: white;
        }

        .logout-modal .btn-confirm:hover {
          background: linear-gradient(135deg, #c82333, #d91a7a);
          transform: translateY(-2px);
        }

        .logout-modal .btn-cancel {
          background: var(--border);
          color: var(--dark);
        }

        .logout-modal .btn-cancel:hover {
          background: #dee2e6;
          transform: translateY(-2px);
        }

        /* Suggestion specific styles */
        .suggestion-reason {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 6px;
            border-left: 3px solid var(--primary);
            margin: 10px 0;
            font-size: 0.9rem;
        }

        .admin-notes {
            background: #fff3cd;
            padding: 10px;
            border-radius: 6px;
            border-left: 3px solid #ffc107;
            margin: 10px 0;
            font-size: 0.9rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
          .sidebar {
            width: 100%;
            height: auto;
            position: relative;
          }

          .main-content {
            margin-left: 0;
          }

          .admin-container {
            flex-direction: column;
          }

          .stats-grid {
            grid-template-columns: 1fr;
          }

          .header-actions {
            flex-direction: column;
            align-items: stretch;
          }

          .search-box {
            max-width: none;
          }

          .book-detail-grid {
            grid-template-columns: 1fr;
            gap: 1rem;
          }

          .modal-content.large {
            margin: 10% auto;
            width: 95%;
          }

          .action-buttons {
            flex-direction: column;
            gap: 4px;
          }

          .modal-actions {
            flex-direction: column;
          }

          .logout-modal-actions {
            flex-direction: column;
          }
        }
    </style>
</head>
<body>
<!-- Global Loading Overlay -->
<div class="loading-overlay" id="globalLoading">
    <div class="spinner"></div>
    <p>Processing your request...</p>
</div>

<!-- Header -->
<header class="admin-header">
    <div class="header-content">
        <div class="header-left">
            <h1>üìö Intelli-Read Admin</h1>
        </div>
        <div class="header-right">
            <div class="admin-info">
                <span>Welcome, Admin</span>
                <button class="logout-btn" onclick="showLogoutConfirmation()">
                    <i class='bx bx-log-out'></i> Logout
                </button>
            </div>
        </div>
    </div>
</header>

<div class="admin-container">
    <!-- Sidebar -->
    <nav class="sidebar">
        <div class="sidebar-header">
            <h2>Admin Panel</h2>
        </div>
        <ul class="sidebar-menu">
            <li class="menu-item active" onclick="showSection('dashboard')">
                <i class='bx bx-dashboard'></i>
                <span>Dashboard</span>
            </li>
            <li class="menu-item" onclick="showSection('users')">
                <i class='bx bx-user'></i>
                <span>Manage Users</span>
            </li>
            <li class="menu-item" onclick="showSection('books')">
                <i class='bx bx-book'></i>
                <span>Manage Books</span>
            </li>
            <!-- ‚úÖ NEW: Manage Suggestions Menu Item -->
            <li class="menu-item" onclick="showSection('suggestions')">
                <i class='bx bx-message-square-dots'></i>
                <span>Manage Suggestions</span>
            </li>
            <li class="menu-item" onclick="showSection('analytics')">
                <i class='bx bx-bar-chart'></i>
                <span>Analytics</span>
            </li>
            <li class="menu-item" onclick="showSection('settings')">
                <i class='bx bx-cog'></i>
                <span>Settings</span>
            </li>
        </ul>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Dashboard Section -->
        <section id="dashboard" class="section active">
            <div class="section-header">
                <h1>Dashboard Overview</h1>
                <p>Welcome to your admin dashboard</p>
            </div>

            <!-- Stats Cards -->
            <div class="stats-grid">
                <div class="stat-card primary">
                    <div class="stat-icon">
                        <i class='bx bx-user'></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalUsers">0</h3>
                        <p>Total Users</p>
                    </div>
                </div>

                <div class="stat-card success">
                    <div class="stat-icon">
                        <i class='bx bx-book'></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalBooks">0</h3>
                        <p>Total Books</p>
                    </div>
                </div>

                <div class="stat-card warning">
                    <div class="stat-icon">
                        <i class='bx bx-time'></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="pendingBooks">0</h3>
                        <p>Pending Books</p>
                    </div>
                </div>

                <div class="stat-card info">
                    <div class="stat-icon">
                        <i class='bx bx-bar-chart'></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="activeUsers">0</h3>
                        <p>Active Today</p>
                    </div>
                </div>
            </div>

            <!-- Additional Stats for Publishers and Suggestions -->
            <div class="stats-grid" style="margin-top: 20px;">
                <div class="stat-card secondary">
                    <div class="stat-icon">
                        <i class='bx bx-user-check'></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalPublishers">0</h3>
                        <p>Approved Publishers</p>
                    </div>
                </div>

                <div class="stat-card danger">
                    <div class="stat-icon">
                        <i class='bx bx-user-x'></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="pendingPublishers">0</h3>
                        <p>Pending Publishers</p>
                    </div>
                </div>

                <!-- ‚úÖ NEW: Suggestions Stats -->
                <div class="stat-card primary">
                    <div class="stat-icon">
                        <i class='bx bx-message-square-dots'></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalSuggestions">0</h3>
                        <p>Total Suggestions</p>
                    </div>
                </div>

                <div class="stat-card warning">
                    <div class="stat-icon">
                        <i class='bx bx-time-five'></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="pendingSuggestions">0</h3>
                        <p>Pending Suggestions</p>
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="activity-section">
                <div class="activity-card">
                    <h3>Recent Activity</h3>
                    <div class="activity-list" id="recentActivity">
                        <!-- Activity items will be loaded here -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Manage Users Section -->
        <section id="users" class="section">
            <div class="section-header">
                <h1>Manage Users</h1>
                <div class="header-actions">
                    <div class="search-box">
                        <i class='bx bx-search'></i>
                        <input type="text" id="userSearch" placeholder="Search users..." onkeyup="searchUsers()">
                    </div>
                    <button class="btn-primary" onclick="exportUsers()">
                        <i class='bx bx-export'></i> Export
                    </button>
                </div>
            </div>

            <div class="table-container">
                <table id="userTable">
                    <thead>
                    <tr>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Role</th>
                        <th>Status</th>
                        <th>Joined</th>
                        <th>Actions</th>
                    </tr>
                    </thead>
                    <tbody id="userTableBody">
                    <!-- Users will be loaded here -->
                    </tbody>
                </table>
            </div>

            <div class="pagination" id="userPagination">
                <!-- Pagination will be loaded here -->
            </div>
        </section>

        <!-- Manage Books Section -->
        <section id="books" class="section">
            <div class="section-header">
                <h1>Manage Books</h1>
                <p>Review and manage books submitted by publishers</p>
                <div class="header-actions">
                    <div class="search-box">
                        <i class='bx bx-search'></i>
                        <input type="text" id="bookSearch" placeholder="Search books..." onkeyup="searchBooks()">
                    </div>
                    <select id="statusFilter" onchange="filterBooks()">
                        <option value="">All Status</option>
                        <option value="pending">Pending</option>
                        <option value="approved">Approved</option>
                        <option value="rejected">Rejected</option>
                    </select>
                </div>
            </div>

            <div class="table-container">
                <table id="bookTable">
                    <thead>
                    <tr>
                        <th>Cover</th>
                        <th>Title & Author</th>
                        <th>Category</th>
                        <th>Publisher</th>
                        <th>Status</th>
                        <th>Submitted</th>
                        <th>Actions</th>
                    </tr>
                    </thead>
                    <tbody id="bookTableBody">
                    <!-- Books will be loaded here -->
                    </tbody>
                </table>
            </div>

            <div class="pagination" id="bookPagination">
                <!-- Pagination will be loaded here -->
            </div>
        </section>

        <!-- ‚úÖ NEW: Manage Suggestions Section -->
        <section id="suggestions" class="section">
            <div class="section-header">
                <h1>Manage Suggestions</h1>
                <p>Review and manage book suggestions from users</p>
                <div class="header-actions">
                    <div class="search-box">
                        <i class='bx bx-search'></i>
                        <input type="text" id="suggestionSearch" placeholder="Search suggestions..." onkeyup="searchSuggestions()">
                    </div>
                    <select id="suggestionStatusFilter" onchange="filterSuggestions()">
                        <option value="">All Status</option>
                        <option value="pending">Pending</option>
                        <option value="approved">Approved</option>
                        <option value="rejected">Rejected</option>
                    </select>
                    <button class="btn-primary" onclick="exportSuggestions()">
                        <i class='bx bx-export'></i> Export
                    </button>
                </div>
            </div>

            <div class="table-container">
                <table id="suggestionTable">
                    <thead>
                    <tr>
                        <th>Title</th>
                        <th>Author</th>
                        <th>User</th>
                        <th>Reason</th>
                        <th>Status</th>
                        <th>Submitted</th>
                        <th>Actions</th>
                    </tr>
                    </thead>
                    <tbody id="suggestionTableBody">
                    <!-- Suggestions will be loaded here -->
                    </tbody>
                </table>
            </div>

            <div class="pagination" id="suggestionPagination">
                <!-- Pagination will be loaded here -->
            </div>
        </section>

        <!-- Analytics Section -->
        <section id="analytics" class="section">
            <div class="section-header">
                <h1>Analytics</h1>
                <p>Platform performance and user insights</p>
            </div>

            <div class="analytics-grid">
                <div class="chart-card">
                    <h3>User Growth</h3>
                    <div class="chart-placeholder" id="userGrowthChart">
                        <p>User growth chart visualization</p>
                    </div>
                </div>

                <div class="chart-card">
                    <h3>Book Categories</h3>
                    <div class="chart-placeholder" id="categoryChart">
                        <p>Category distribution chart</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Settings Section -->
        <section id="settings" class="section">
            <div class="section-header">
                <h1>Settings</h1>
                <p>Manage your admin preferences</p>
            </div>

            <div class="settings-grid">
                <div class="setting-card">
                    <h3>General Settings</h3>
                    <div class="setting-item">
                        <label>Platform Name</label>
                        <input type="text" value="Intelli-Read">
                    </div>
                    <div class="setting-item">
                        <label>Admin Email</label>
                        <input type="email" value="admin@intelliread.com">
                    </div>
                </div>

                <div class="setting-card">
                    <h3>Security</h3>
                    <div class="setting-item">
                        <label>Auto-logout (minutes)</label>
                        <input type="number" value="30">
                    </div>
                    <div class="setting-item">
                        <label>Enable 2FA</label>
                        <label class="switch">
                            <input type="checkbox">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
            </div>
        </section>
    </main>
</div>

<!-- Modal for user details -->
<div id="userModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>User Details</h2>
        <div id="userDetails">
            <!-- User details will be loaded here -->
        </div>
    </div>
</div>

<!-- Modal for book details -->
<div id="bookModal" class="modal">
    <div class="modal-content large">
        <span class="close">&times;</span>
        <h2>Book Details</h2>
        <div id="bookDetails">
            <!-- Book details will be loaded here -->
        </div>
    </div>
</div>

<!-- ‚úÖ NEW: Modal for suggestion details -->
<div id="suggestionModal" class="modal">
    <div class="modal-content large">
        <span class="close">&times;</span>
        <h2>Suggestion Details</h2>
        <div id="suggestionDetails">
            <!-- Suggestion details will be loaded here -->
        </div>
    </div>
</div>

<!-- Rejection Reason Modal for Books -->
<div id="rejectionModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Reject Book</h2>
        <form id="rejectionForm">
            <div class="form-group">
                <label for="rejectionReason">Reason for Rejection *</label>
                <textarea id="rejectionReason" required placeholder="Please provide a reason for rejecting this book..." style="width: 100%; height: 120px; padding: 10px; border: 1px solid var(--border); border-radius: 5px;"></textarea>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn-secondary" onclick="closeRejectionModal()">Cancel</button>
                <button type="submit" class="btn-danger">Reject Book</button>
            </div>
        </form>
    </div>
</div>

<!-- ‚úÖ NEW: Suggestion Approval Modal -->
<div id="suggestionApprovalModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Approve Suggestion</h2>
        <form id="suggestionApprovalForm">
            <div class="form-group">
                <label for="approvalNotes">Admin Notes (Optional)</label>
                <textarea id="approvalNotes" placeholder="Add any notes or comments for the user..." style="width: 100%; height: 120px; padding: 10px; border: 1px solid var(--border); border-radius: 5px;"></textarea>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn-secondary" onclick="closeSuggestionApprovalModal()">Cancel</button>
                <button type="submit" class="btn-success">Approve Suggestion</button>
            </div>
        </form>
    </div>
</div>

<!-- ‚úÖ NEW: Suggestion Rejection Modal -->
<div id="suggestionRejectionModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Reject Suggestion</h2>
        <form id="suggestionRejectionForm">
            <div class="form-group">
                <label for="rejectionNotes">Reason for Rejection *</label>
                <textarea id="rejectionNotes" required placeholder="Please provide a reason for rejecting this suggestion..." style="width: 100%; height: 120px; padding: 10px; border: 1px solid var(--border); border-radius: 5px;"></textarea>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn-secondary" onclick="closeSuggestionRejectionModal()">Cancel</button>
                <button type="submit" class="btn-danger">Reject Suggestion</button>
            </div>
        </form>
    </div>
</div>

<!-- Logout Confirmation Modal -->
<div id="logoutModal" class="modal">
    <div class="modal-content">
        <div class="logout-modal">
            <h2><i class='bx bx-log-out'></i> Confirm Logout</h2>
            <p>Are you sure you want to log out from this session?</p>
            <div class="logout-modal-actions">
                <button class="btn btn-confirm" onclick="confirmLogout()">Yes, Logout</button>
                <button class="btn btn-cancel" onclick="closeLogoutModal()">Cancel</button>
            </div>
        </div>
    </div>
</div>

<script>
    // ===== GLOBAL VARIABLES =====
    let currentUserPage = 1;
    let currentBookPage = 1;
    let currentSuggestionPage = 1;

    const usersPerPage = 6;
    const booksPerPage = 6;
    const suggestionsPerPage = 6;

    let allUsers = [];
    let allBooks = [];
    let allSuggestions = [];

    let currentRejectBookId = null;
    let currentApproveSuggestionId = null;
    let currentRejectSuggestionId = null;

    // ===== DASHBOARD INITIALIZATION =====
    document.addEventListener('DOMContentLoaded', function() {
        console.log('üèÅ Admin Dashboard Initialized');
        checkAdminAuth();

        setTimeout(() => {
            console.log('üîÑ Loading dashboard data...');

            loadDashboardSummary().catch(err => {
                console.log('üìä Dashboard summary failed, using demo data');
                setDemoDashboardData();
            });

            loadUsers().catch(err => {
                console.log('üë• Users loading failed, using demo data');
                showDemoUsers();
            });

            loadBooks().catch(err => {
                console.log('üìö Books loading failed, using demo data');
                showDemoBooks();
            });

            // ‚úÖ NEW: Load suggestions
            loadSuggestions().catch(err => {
                console.log('üí° Suggestions loading failed, using demo data');
                showDemoSuggestions();
            });

        }, 1000);

        setupEventListeners();
    });

    // ===== AUTHENTICATION FUNCTIONS =====
    function checkAdminAuth() {
        const admin = sessionStorage.getItem('admin');
        if (!admin) {
            console.log('‚ùå No admin session found, redirecting to login...');
            window.location.href = '/admin';
            return;
        }
        console.log('‚úÖ Admin authenticated');
    }

    // ===== NAVIGATION FUNCTIONS =====
    function showSection(sectionId) {
        const sections = document.querySelectorAll('.section');
        sections.forEach(section => {
            section.classList.remove('active');
        });

        const menuItems = document.querySelectorAll('.menu-item');
        menuItems.forEach(item => {
            item.classList.remove('active');
        });

        const targetSection = document.getElementById(sectionId);
        if (targetSection) {
            targetSection.classList.add('active');
        }

        const targetMenuItem = document.querySelector(`.menu-item[onclick="showSection('${sectionId}')"]`);
        if (targetMenuItem) {
            targetMenuItem.classList.add('active');
        }

        switch(sectionId) {
            case 'dashboard':
                loadDashboardSummary();
                break;
            case 'users':
                loadUsers();
                break;
            case 'books':
                loadBooks();
                break;
            case 'suggestions':
                loadSuggestions();
                break;
            case 'analytics':
                loadAnalytics();
                break;
        }
    }

    // ===== DASHBOARD DATA FUNCTIONS =====
    async function loadDashboardSummary() {
        try {
            console.log('üìä Loading dashboard summary...');

            const response = await fetch('/api/admin/summary');

            if (!response.ok) {
                console.warn('‚ö†Ô∏è Dashboard API returned error:', response.status);
                setDemoDashboardData();
                return;
            }

            const contentType = response.headers.get('content-type');
            if (!contentType || !contentType.includes('application/json')) {
                console.warn('‚ö†Ô∏è Dashboard API returned non-JSON response');
                setDemoDashboardData();
                return;
            }

            const data = await response.json();

            if (data.success) {
                document.getElementById('totalUsers').textContent = data.totalUsers || 0;
                document.getElementById('totalBooks').textContent = data.totalBooks || 0;
                document.getElementById('pendingBooks').textContent = data.pendingBooks || 0;
                document.getElementById('activeUsers').textContent = data.activeUsers || 0;

                const pendingPublishersElement = document.getElementById('pendingPublishers');
                const totalPublishersElement = document.getElementById('totalPublishers');

                if (pendingPublishersElement) {
                    pendingPublishersElement.textContent = data.pendingPublishers || 0;
                }
                if (totalPublishersElement) {
                    totalPublishersElement.textContent = data.totalPublishers || 0;
                }

                // ‚úÖ NEW: Load suggestion stats
                await loadSuggestionStats();

                loadRecentActivity(data.recentActivity);
            } else {
                console.error('Error loading dashboard summary:', data.message);
                setDemoDashboardData();
            }
        } catch (error) {
            console.error('Error loading dashboard summary:', error);
            setDemoDashboardData();
        }
    }

    // ‚úÖ NEW: Load suggestion statistics
    async function loadSuggestionStats() {
        try {
            const response = await fetch('/suggestion/apis/admin/stats');
            if (response.ok) {
                const data = await response.json();
                document.getElementById('totalSuggestions').textContent = data.total || 0;
                document.getElementById('pendingSuggestions').textContent = data.pending || 0;
            } else {
                // Fallback to demo data
                document.getElementById('totalSuggestions').textContent = '24';
                document.getElementById('pendingSuggestions').textContent = '8';
            }
        } catch (error) {
            console.error('Error loading suggestion stats:', error);
            document.getElementById('totalSuggestions').textContent = '24';
            document.getElementById('pendingSuggestions').textContent = '8';
        }
    }

    function setDemoDashboardData() {
        document.getElementById('totalUsers').textContent = '1,254';
        document.getElementById('totalBooks').textContent = '567';
        document.getElementById('pendingBooks').textContent = '23';
        document.getElementById('activeUsers').textContent = '189';
        document.getElementById('pendingPublishers').textContent = '5';
        document.getElementById('totalPublishers').textContent = '47';
        document.getElementById('totalSuggestions').textContent = '24';
        document.getElementById('pendingSuggestions').textContent = '8';
    }

    async function loadRecentActivity(activities = null) {
        try {
            const activityList = document.getElementById('recentActivity');
            if (!activityList) return;

            if (!activities) {
                const response = await fetch('/api/admin/activities');
                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        activities = data.activities;
                    }
                }
            }

            if (!activities || activities.length === 0) {
                activities = [
                    {
                        type: 'user',
                        message: 'New user registration',
                        time: 'Just now',
                        icon: 'bx-user-plus'
                    },
                    {
                        type: 'book',
                        message: 'New book pending approval',
                        time: '5 minutes ago',
                        icon: 'bx-book-add'
                    },
                    {
                        type: 'system',
                        message: 'Publisher account approved',
                        time: '1 hour ago',
                        icon: 'bx-user-check'
                    }
                ];
            }

            activityList.innerHTML = '';

            activities.forEach(activity => {
                const activityItem = document.createElement('div');
                activityItem.className = 'activity-item';

                activityItem.innerHTML = `
                    <div class="activity-icon ${activity.type}">
                        <i class='bx ${activity.icon}'></i>
                    </div>
                    <div class="activity-info">
                        <p>${activity.message}</p>
                        <span>${activity.time}</span>
                    </div>
                `;

                activityList.appendChild(activityItem);
            });
        } catch (error) {
            console.error('Error loading recent activity:', error);
        }
    }

    // ===== USER MANAGEMENT FUNCTIONS =====
    async function loadUsers(page = 1) {
        try {
            currentUserPage = page;

            const userTableBody = document.getElementById('userTableBody');
            userTableBody.innerHTML = `
                <tr>
                    <td colspan="6" class="loading-cell">
                        <div class="loading-spinner"></div>
                        Loading users...
                    </td>
                </tr>
            `;

            console.log('üë• Loading users...');

            const response = await fetch(`/api/admin/users?page=${page}&limit=${usersPerPage}`);

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const contentType = response.headers.get('content-type');
            if (!contentType || !contentType.includes('application/json')) {
                throw new Error('API returned non-JSON response');
            }

            const data = await response.json();

            if (data.success) {
                allUsers = data.users;
                displayUsers(allUsers);
                updateUserPagination(data.totalPages, page);
            } else {
                console.error('Error loading users:', data.message);
                showNotification('Error loading users: ' + data.message, 'error');
            }
        } catch (error) {
            console.error('Error loading users:', error);
            showNotification('Network error loading users: ' + error.message, 'error');
        }
    }

    function displayUsers(users) {
        const userTableBody = document.getElementById('userTableBody');
        if (!userTableBody) {
            console.error('User table body not found');
            return;
        }

        userTableBody.innerHTML = '';

        if (!users || users.length === 0) {
            userTableBody.innerHTML = `
                <tr>
                    <td colspan="6" class="no-data">
                        <i class='bx bx-user-x'></i>
                        <p>No users found</p>
                    </td>
                </tr>
            `;
            return;
        }

        users.forEach(user => {
            try {
                const row = document.createElement('tr');

                const userName = user.fullName || user.name || 'Unknown User';
                const userEmail = user.email || 'No email';
                const userRole = user.role || 'user';
                const userCreatedAt = user.createdAt || new Date().toISOString();

                let statusText, statusClass;
                if (userRole === 'publisher' || userRole === 'PUBLISHER') {
                    if (user.isApproved) {
                        statusText = 'Approved Publisher';
                        statusClass = 'status-approved';
                    } else {
                        statusText = 'Pending Approval';
                        statusClass = 'status-pending';
                    }
                } else {
                    statusText = user.isActive !== false ? 'Active User' : 'Inactive';
                    statusClass = user.isActive !== false ? 'status-active' : 'status-inactive';
                }

                row.innerHTML = `
                    <td>
                        <div class="user-avatar">
                            <i class='bx bx-user'></i>
                            <span>${userName}</span>
                        </div>
                    </td>
                    <td>${userEmail}</td>
                    <td>
                        <span class="role-badge ${userRole.toLowerCase()}">${userRole}</span>
                    </td>
                    <td>
                        <span class="status-badge ${statusClass}">${statusText}</span>
                    </td>
                    <td>${formatDate(userCreatedAt)}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-info" onclick="viewUser('${user._id}')" title="View Details">
                                <i class='bx bx-show'></i> View
                            </button>
                            ${(userRole === 'publisher' || userRole === 'PUBLISHER') && !user.isApproved ?
                                `<button class="btn-success" onclick="approvePublisher('${user._id}')" title="Approve Publisher">
                                    <i class='bx bx-check'></i> Approve
                                </button>
                                 <button class="btn-danger" onclick="rejectPublisher('${user._id}')" title="Reject Publisher">
                                    <i class='bx bx-x'></i> Reject
                                 </button>` :
                                `<button class="btn-danger" onclick="deleteUser('${user._id}')" title="Delete User">
                                    <i class='bx bx-trash'></i> Delete
                                 </button>`
                            }
                        </div>
                    </td>
                `;

                userTableBody.appendChild(row);
            } catch (error) {
                console.error('Error rendering user row:', error, user);
            }
        });
    }

    function updateUserPagination(totalPages, currentPage) {
        const pagination = document.getElementById('userPagination');
        if (!pagination) return;

        let paginationHTML = '';

        if (currentPage > 1) {
            paginationHTML += `<button class="page-btn" onclick="loadUsers(${currentPage - 1})">Previous</button>`;
        }

        for (let i = 1; i <= totalPages; i++) {
            if (i === currentPage) {
                paginationHTML += `<button class="page-btn active">${i}</button>`;
            } else {
                paginationHTML += `<button class="page-btn" onclick="loadUsers(${i})">${i}</button>`;
            }
        }

        if (currentPage < totalPages) {
            paginationHTML += `<button class="page-btn" onclick="loadUsers(${currentPage + 1})">Next</button>`;
        }

        pagination.innerHTML = paginationHTML;
    }

    async function approvePublisher(userId) {
        if (confirm('Are you sure you want to approve this publisher?')) {
            try {
                showNotification('Approving publisher...', 'info');

                const response = await fetch(`/api/admin/publishers/${userId}/approve`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });

                const data = await response.json();

                if (data.success) {
                    showNotification('Publisher approved successfully!', 'success');
                    loadUsers(currentUserPage);
                    loadDashboardSummary();
                } else {
                    showNotification('Error: ' + data.message, 'error');
                }
            } catch (error) {
                console.error('Error approving publisher:', error);
                showNotification('Error approving publisher', 'error');
            }
        }
    }

    async function rejectPublisher(userId) {
        if (confirm('‚ö†Ô∏è ARE YOU SURE YOU WANT TO REJECT THIS PUBLISHER?\n\nThis will:\n‚Ä¢ Permanently delete the publisher account\n‚Ä¢ Delete ALL books uploaded by this publisher\n‚Ä¢ This action cannot be undone!')) {
            try {
                showNotification('Rejecting publisher and deleting all data...', 'warning');

                const response = await fetch(`/api/admin/publishers/${userId}/reject`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });

                const data = await response.json();

                if (data.success) {
                    showNotification('‚úÖ Publisher rejected and all data permanently deleted!', 'success');
                    loadUsers(currentUserPage);
                    loadDashboardSummary();
                } else {
                    showNotification('‚ùå Error: ' + data.message, 'error');
                }
            } catch (error) {
                console.error('Error rejecting publisher:', error);
                showNotification('‚ùå Error rejecting publisher', 'error');
            }
        }
    }

    async function viewUser(userId) {
        try {
            console.log('üë§ Viewing user:', userId);

            const response = await fetch(`/api/admin/users/${userId}`);

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const data = await response.json();

            if (data.success) {
                showUserModal(data.user);
            } else {
                console.error('Error loading user details:', data.message);
                showNotification('Error loading user details: ' + data.message, 'error');
            }
        } catch (error) {
            console.error('Error viewing user:', error);

            const user = allUsers.find(u => u._id == userId);
            if (user) {
                showUserModal(user);
            } else {
                showNotification('Error loading user details. Please try again.', 'error');
            }
        }
    }

    function showUserModal(user) {
        const modal = document.getElementById('userModal');
        const userDetails = document.getElementById('userDetails');

        if (!modal || !userDetails) {
            console.error('Modal elements not found');
            showNotification('Error: Could not open user details', 'error');
            return;
        }

        try {
            const joinDate = user.createdAt ? formatDateTime(user.createdAt) : 'Unknown';
            const lastLogin = user.lastLogin ? formatDateTime(user.lastLogin) : 'Never';
            const publisherSince = user.publisherSince ? formatDateTime(user.publisherSince) : 'Not applicable';

            let statusText, statusClass;
            if (user.role === 'publisher' || user.role === 'PUBLISHER') {
                if (user.isApproved) {
                    statusText = 'Approved Publisher';
                    statusClass = 'status-approved';
                } else {
                    statusText = 'Pending Approval';
                    statusClass = 'status-pending';
                }
            } else {
                statusText = user.isActive !== false ? 'Active User' : 'Inactive';
                statusClass = user.isActive !== false ? 'status-active' : 'status-inactive';
            }

            userDetails.innerHTML = `
                <div class="user-detail-grid">
                    <div class="user-detail">
                        <label>Full Name:</label>
                        <span>${user.fullName || user.name || 'N/A'}</span>
                    </div>
                    <div class="user-detail">
                        <label>Email:</label>
                        <span>${user.email || 'N/A'}</span>
                    </div>
                    <div class="user-detail">
                        <label>Role:</label>
                        <span class="role-badge ${(user.role || 'user').toLowerCase()}">
                            ${user.role || 'User'}
                        </span>
                    </div>
                    <div class="user-detail">
                        <label>Status:</label>
                        <span class="status-badge ${statusClass}">${statusText}</span>
                    </div>
                    <div class="user-detail">
                        <label>Account Created:</label>
                        <span>${joinDate}</span>
                    </div>
                    <div class="user-detail">
                        <label>Last Login:</label>
                        <span>${lastLogin}</span>
                    </div>
                    ${(user.role === 'publisher' || user.role === 'PUBLISHER') ? `
                    <div class="user-detail">
                        <label>Publisher Status:</label>
                        <span class="status-badge ${user.isApproved ? 'status-approved' : 'status-pending'}">
                            ${user.isApproved ? 'Approved' : 'Pending Approval'}
                        </span>
                    </div>
                    <div class="user-detail">
                        <label>Publisher Since:</label>
                        <span>${publisherSince}</span>
                    </div>
                    ` : ''}
                    <div class="user-detail">
                        <label>Books Published:</label>
                        <span>${user.booksPublished || 0}</span>
                    </div>
                    <div class="user-detail">
                        <label>Preferred Language:</label>
                        <span>${user.preferredLanguage || 'English'}</span>
                    </div>
                </div>
                <div class="modal-actions">
                    ${(user.role === 'publisher' || user.role === 'PUBLISHER') && !user.isApproved ? `
                        <button class="btn-success" onclick="approvePublisher('${user._id}')">
                            <i class='bx bx-check'></i> Approve Publisher
                        </button>
                        <button class="btn-danger" onclick="rejectPublisher('${user._id}')">
                            <i class='bx bx-x'></i> Reject Publisher
                        </button>
                    ` : `
                        <button class="btn-primary" onclick="editUser('${user._id}')">
                            <i class='bx bx-edit'></i> Edit User
                        </button>
                    `}
                    <button class="btn-danger" onclick="deleteUser('${user._id}')">
                        <i class='bx bx-trash'></i> Delete User
                    </button>
                </div>
            `;

            modal.style.display = 'block';
        } catch (error) {
            console.error('Error displaying user modal:', error);
            userDetails.innerHTML = `
                <div class="no-data">
                    <i class='bx bx-error'></i>
                    <p>Error loading user details</p>
                    <p style="font-size: 0.9rem; color: var(--gray);">${error.message}</p>
                </div>
            `;
            modal.style.display = 'block';
        }
    }

    async function editUser(userId) {
        showNotification('Edit user functionality coming soon!', 'info');
    }

    async function deleteUser(userId) {
        try {
            const user = allUsers.find(u => u._id == userId);
            if (!user) {
                showNotification('User not found', 'error');
                return;
            }

            if (confirm(`‚ö†Ô∏è ARE YOU SURE YOU WANT TO PERMANENTLY DELETE USER "${user.fullName || user.name}"?\n\nThis will:\n‚Ä¢ Delete user account permanently\n‚Ä¢ Delete all user data\n‚Ä¢ This action cannot be undone!`)) {
                showNotification('Deleting user...', 'warning');

                const response = await fetch(`/api/admin/users/${userId}`, {
                    method: 'DELETE'
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || `HTTP error! status: ${response.status}`);
                }

                const data = await response.json();

                if (data.success) {
                    showNotification('‚úÖ User permanently deleted from database!', 'success');
                    loadUsers(currentUserPage);
                    loadDashboardSummary();

                    const modal = document.getElementById('userModal');
                    if (modal) modal.style.display = 'none';
                } else {
                    showNotification('‚ùå Error: ' + data.message, 'error');
                }
            }
        } catch (error) {
            console.error('Error deleting user:', error);
            showNotification('‚ùå Error deleting user: ' + error.message, 'error');
        }
    }

    function searchUsers() {
        const searchTerm = document.getElementById('userSearch').value.toLowerCase();
        const rows = document.querySelectorAll('#userTableBody tr');
        rows.forEach(row => {
            const text = row.textContent.toLowerCase();
            row.style.display = text.includes(searchTerm) ? '' : 'none';
        });
    }

    function showDemoUsers() {
        const userTableBody = document.getElementById('userTableBody');
        if (!userTableBody) return;

        userTableBody.innerHTML = `
            <tr>
                <td colspan="6" class="no-data">
                    <i class='bx bx-user-x'></i>
                    <p>No users found</p>
                </td>
            </tr>
        `;
    }

    // ===== BOOK MANAGEMENT FUNCTIONS =====
    async function loadBooks(page = 1) {
        try {
            currentBookPage = page;

            const bookTableBody = document.getElementById('bookTableBody');
            bookTableBody.innerHTML = `
                <tr>
                    <td colspan="7" class="loading-cell">
                        <div class="loading-spinner"></div>
                        Loading books...
                    </td>
                </tr>
            `;

            console.log('üìö Loading books...');

            const response = await fetch(`/api/admin/books?page=${page}&limit=${booksPerPage}&status=all`);

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const contentType = response.headers.get('content-type');
            if (!contentType || !contentType.includes('application/json')) {
                throw new Error('API returned non-JSON response');
            }

            const data = await response.json();

            if (data.success) {
                allBooks = data.books;
                displayBooks(allBooks);
                updateBookPagination(data.totalPages, page);
            } else {
                console.error('Error loading books:', data.message);
                showNotification('Error loading books: ' + data.message, 'error');
            }
        } catch (error) {
            console.error('Error loading books:', error);
            showNotification('Network error loading books: ' + error.message, 'error');
        }
    }

    function displayBooks(books) {
        const bookTableBody = document.getElementById('bookTableBody');
        if (!bookTableBody) {
            console.error('Book table body not found');
            return;
        }

        bookTableBody.innerHTML = '';

        if (!books || books.length === 0) {
            bookTableBody.innerHTML = `
                <tr>
                    <td colspan="7" class="no-data">
                        <i class='bx bx-book-open'></i>
                        <p>No books found</p>
                    </td>
                </tr>
            `;
            return;
        }

        books.forEach(book => {
            const row = document.createElement('tr');

            let statusClass = '';
            let statusText = book.status ? book.status.charAt(0).toUpperCase() + book.status.slice(1) : 'Unknown';
            switch(book.status) {
                case 'approved':
                    statusClass = 'status-approved';
                    break;
                case 'pending':
                    statusClass = 'status-pending';
                    break;
                case 'rejected':
                    statusClass = 'status-rejected';
                    break;
                default:
                    statusClass = 'status-pending';
            }

            row.innerHTML = `
                <td>
                    ${book.coverImage ?
                        `<img src="${book.coverImage}" alt="${book.title}" class="book-cover">` :
                        '<div class="book-cover-placeholder"><i class="bx bx-book"></i></div>'
                    }
                </td>
                <td>
                    <div class="book-title">
                        <strong>${book.title || 'Untitled'}</strong>
                        <div style="font-size: 0.8rem; color: var(--gray); margin-top: 4px;">
                            by ${book.author || 'Unknown Author'}
                        </div>
                    </div>
                </td>
                <td>
                    <span class="category-tag">${book.category || 'Uncategorized'}</span>
                </td>
                <td>
                    <div style="font-size: 0.9rem;">
                        ${book.publisherName || 'Unknown Publisher'}
                    </div>
                </td>
                <td>
                    <span class="status-badge ${statusClass}">${statusText}</span>
                </td>
                <td>${book.createdAt ? formatDate(book.createdAt) : 'Unknown'}</td>
                <td>
                    <div class="action-buttons">
                        <button class="btn-info" onclick="viewBook('${book._id}')" title="View Details">
                            <i class='bx bx-show'></i> View
                        </button>
                        ${book.status === 'pending' ?
                            `<button class="btn-success" onclick="approveBook('${book._id}')" title="Approve Book">
                                <i class='bx bx-check'></i> Approve
                            </button>
                             <button class="btn-danger" onclick="showRejectionModal('${book._id}')" title="Reject Book">
                                <i class='bx bx-x'></i> Reject
                             </button>` :
                            `<button class="btn-warning" onclick="editBook('${book._id}')" title="Edit Book">
                                <i class='bx bx-edit'></i> Edit
                            </button>`
                        }
                        <button class="btn-danger" onclick="deleteBook('${book._id}')" title="Delete Book">
                            <i class='bx bx-trash'></i> Delete
                        </button>
                    </div>
                </td>
            `;

            bookTableBody.appendChild(row);
        });
    }

    function updateBookPagination(totalPages, currentPage) {
        const pagination = document.getElementById('bookPagination');
        if (!pagination) return;

        let paginationHTML = '';

        if (currentPage > 1) {
            paginationHTML += `<button class="page-btn" onclick="loadBooks(${currentPage - 1})">Previous</button>`;
        }

        for (let i = 1; i <= totalPages; i++) {
            if (i === currentPage) {
                paginationHTML += `<button class="page-btn active">${i}</button>`;
            } else {
                paginationHTML += `<button class="page-btn" onclick="loadBooks(${i})">${i}</button>`;
            }
        }

        if (currentPage < totalPages) {
            paginationHTML += `<button class="page-btn" onclick="loadBooks(${currentPage + 1})">Next</button>`;
        }

        pagination.innerHTML = paginationHTML;
    }

    async function approveBook(bookId) {
        if (confirm('Are you sure you want to approve this book?')) {
            try {
                showNotification('Approving book...', 'info');

                const response = await fetch(`/api/admin/books/${bookId}/approve`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });

                const data = await response.json();

                if (data.success) {
                    showNotification('Book approved successfully!', 'success');
                    loadBooks(currentBookPage);
                    loadDashboardSummary();
                    document.getElementById('bookModal').style.display = 'none';
                } else {
                    showNotification('Error: ' + data.message, 'error');
                }
            } catch (error) {
                console.error('Error approving book:', error);
                showNotification('Error approving book', 'error');
            }
        }
    }

    function showRejectionModal(bookId) {
        currentRejectBookId = bookId;
        const modal = document.getElementById('rejectionModal');
        if (modal) {
            modal.style.display = 'block';
            document.getElementById('rejectionReason').value = '';
        }
    }

    function closeRejectionModal() {
        const modal = document.getElementById('rejectionModal');
        if (modal) {
            modal.style.display = 'none';
            currentRejectBookId = null;
        }
    }

    document.getElementById('rejectionForm').addEventListener('submit', async function(e) {
        e.preventDefault();

        if (!currentRejectBookId) return;

        const reason = document.getElementById('rejectionReason').value;

        if (!reason.trim()) {
            showNotification('Please provide a reason for rejection', 'error');
            return;
        }

        if (confirm(`‚ö†Ô∏è FINAL CONFIRMATION:\n\nAre you absolutely sure you want to REJECT and PERMANENTLY DELETE this book?\n\nReason: ${reason}\n\nThis action cannot be undone!`)) {
            await rejectBook(currentRejectBookId, reason);
        }
    });

    async function rejectBook(bookId, reason) {
        if (confirm('Are you sure you want to REJECT and PERMANENTLY DELETE this book from database? This action cannot be undone!')) {
            try {
                showNotification('Rejecting and deleting book...', 'warning');

                const response = await fetch(`/api/admin/books/${bookId}/reject`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ reason: reason })
                });

                const data = await response.json();

                if (data.success) {
                    showNotification('‚úÖ Book rejected and permanently deleted from database!', 'success');
                    loadBooks(currentBookPage);
                    loadDashboardSummary();
                    closeRejectionModal();
                } else {
                    showNotification('‚ùå Error: ' + data.message, 'error');
                }
            } catch (error) {
                console.error('Error rejecting book:', error);
                showNotification('‚ùå Error rejecting book', 'error');
            }
        }
    }

    async function viewBook(bookId) {
        try {
            const response = await fetch(`/api/admin/books/${bookId}`);

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const data = await response.json();

            if (data.success) {
                showBookModal(data.book);
            } else {
                console.error('Error loading book details:', data.message);
                showNotification('Error loading book details: ' + data.message, 'error');
            }
        } catch (error) {
            console.error('Error viewing book:', error);

            const book = allBooks.find(b => b._id === bookId);
            if (book) {
                showBookModal(book);
            } else {
                showNotification('Error loading book details. Please try again.', 'error');
            }
        }
    }

    function showBookModal(book) {
        const modal = document.getElementById('bookModal');
        const bookDetails = document.getElementById('bookDetails');

        if (modal && bookDetails) {
            const statusText = book.status ? book.status.charAt(0).toUpperCase() + book.status.slice(1) : 'Unknown';
            const statusClass = book.status ? `status-${book.status}` : 'status-pending';

            bookDetails.innerHTML = `
                <div class="book-detail-grid">
                    <div class="book-cover-large">
                        ${book.coverImage ?
                            `<img src="${book.coverImage}" alt="${book.title}" style="max-width: 200px; border-radius: 8px;">` :
                            '<div class="book-cover-placeholder" style="width: 200px; height: 300px; background: #f8f9fa; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #6c757d; font-size: 3rem;"><i class="bx bx-book"></i></div>'
                        }
                    </div>
                    <div class="book-info">
                        <h3>${book.title || 'Untitled'}</h3>
                        <p class="book-author">by ${book.author || 'Unknown Author'}</p>

                        <div class="book-meta">
                            <span class="category-tag">${book.category || 'Uncategorized'}</span>
                            <span class="status-badge ${statusClass}">
                                ${statusText}
                            </span>
                            ${book.isFeatured ? '<span class="featured-badge">Featured</span>' : ''}
                        </div>

                        <div style="margin: 1rem 0; padding: 1rem; background: #f8f9fa; border-radius: 6px;">
                            <strong>Publisher:</strong> ${book.publisherName || 'Unknown'}
                        </div>

                        ${book.description ? `
                        <div class="book-description">
                            <h4>Description</h4>
                            <p>${book.description}</p>
                        </div>
                        ` : ''}

                        <div class="book-stats">
                            <div class="stat">
                                <label>Language:</label>
                                <span>${book.language || 'English'}</span>
                            </div>
                            <div class="stat">
                                <label>Submitted:</label>
                                <span>${book.createdAt ? formatDateTime(book.createdAt) : 'Unknown'}</span>
                            </div>
                            ${book.reviewedAt ? `
                            <div class="stat">
                                <label>Reviewed:</label>
                                <span>${formatDateTime(book.reviewedAt)}</span>
                            </div>
                            ` : ''}
                            ${book.adminNotes ? `
                            <div class="stat">
                                <label>Admin Notes:</label>
                                <span style="color: var(--warning);">${book.adminNotes}</span>
                            </div>
                            ` : ''}
                        </div>
                    </div>
                </div>
                <div class="modal-actions">
                    ${book.status === 'pending' ? `
                        <button class="btn-success" onclick="approveBook('${book._id}')">
                            <i class='bx bx-check'></i> Approve
                        </button>
                        <button class="btn-danger" onclick="showRejectionModal('${book._id}')">
                            <i class='bx bx-x'></i> Reject
                        </button>
                    ` : ''}
                    <button class="btn-primary" onclick="editBook('${book._id}')">
                        <i class='bx bx-edit'></i> Edit
                    </button>
                    ${book.isFeatured ? `
                        <button class="btn-secondary" onclick="unfeatureBook('${book._id}')">
                            <i class='bx bx-star'></i> Unfeature
                        </button>
                    ` : `
                        <button class="btn-success" onclick="featureBook('${book._id}')">
                            <i class='bx bx-star'></i> Feature
                        </button>
                    `}
                    <button class="btn-danger" onclick="deleteBook('${book._id}')">
                        <i class='bx bx-trash'></i> Delete
                    </button>
                </div>
            `;

            modal.style.display = 'block';
        }
    }

    async function editBook(bookId) {
        showNotification('Edit book functionality coming soon!', 'info');
    }

    async function featureBook(bookId) {
        showNotification('Feature book functionality coming soon!', 'info');
    }

    async function unfeatureBook(bookId) {
        showNotification('Unfeature book functionality coming soon!', 'info');
    }

    async function deleteBook(bookId) {
        const book = allBooks.find(b => b._id == bookId);
        if (!book) return;

        if (confirm(`‚ö†Ô∏è ARE YOU SURE YOU WANT TO PERMANENTLY DELETE BOOK "${book.title}"?\n\nThis will:\n‚Ä¢ Delete book permanently from database\n‚Ä¢ Remove all book data\n‚Ä¢ This action cannot be undone!`)) {
            try {
                showNotification('Deleting book...', 'warning');

                const response = await fetch(`/api/admin/books/${bookId}`, {
                    method: 'DELETE'
                });

                const data = await response.json();

                if (data.success) {
                    showNotification('‚úÖ Book permanently deleted from database!', 'success');
                    loadBooks(currentBookPage);
                    loadDashboardSummary();
                    const modal = document.getElementById('bookModal');
                    if (modal) modal.style.display = 'none';
                } else {
                    showNotification('‚ùå Error: ' + data.message, 'error');
                }
            } catch (error) {
                console.error('Error deleting book:', error);
                showNotification('‚ùå Error deleting book', 'error');
            }
        }
    }

    function searchBooks() {
        const searchTerm = document.getElementById('bookSearch').value.toLowerCase();
        const rows = document.querySelectorAll('#bookTableBody tr');
        rows.forEach(row => {
            const text = row.textContent.toLowerCase();
            row.style.display = text.includes(searchTerm) ? '' : 'none';
        });
    }

    function filterBooks() {
        const statusFilter = document.getElementById('statusFilter').value;
        const rows = document.querySelectorAll('#bookTableBody tr');

        rows.forEach(row => {
            if (!statusFilter) {
                row.style.display = '';
                return;
            }

            const statusBadge = row.querySelector('.status-badge');
            if (statusBadge && statusBadge.textContent.toLowerCase() === statusFilter.toLowerCase()) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        });
    }

    function showDemoBooks() {
        const bookTableBody = document.getElementById('bookTableBody');
        if (!bookTableBody) return;

        bookTableBody.innerHTML = `
            <tr>
                <td colspan="7" class="no-data">
                    <i class='bx bx-book-open'></i>
                    <p>No books found</p>
                </td>
            </tr>
        `;
    }

    // ===== SUGGESTION MANAGEMENT FUNCTIONS =====
    async function loadSuggestions(page = 1) {
        try {
            currentSuggestionPage = page;

            const suggestionTableBody = document.getElementById('suggestionTableBody');
            suggestionTableBody.innerHTML = `
                <tr>
                    <td colspan="7" class="loading-cell">
                        <div class="loading-spinner"></div>
                        Loading suggestions...
                    </td>
                </tr>
            `;

            console.log('üí° Loading suggestions...');

            const response = await fetch(`/suggestion/apis/admin/all`);

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const data = await response.json();

            if (Array.isArray(data)) {
                allSuggestions = data;
                displaySuggestions(allSuggestions);

                updateSuggestionPagination(Math.ceil(data.length / suggestionsPerPage), page);
            } else {
                console.error('Error loading suggestions: Invalid response format');
                showNotification('Error loading suggestions', 'error');
            }
        } catch (error) {
            console.error('Error loading suggestions:', error);
            showNotification('Network error loading suggestions: ' + error.message, 'error');
        }
    }

    function displaySuggestions(suggestions) {
        const suggestionTableBody = document.getElementById('suggestionTableBody');
        if (!suggestionTableBody) {
            console.error('Suggestion table body not found');
            return;
        }

        suggestionTableBody.innerHTML = '';

        if (!suggestions || suggestions.length === 0) {
            suggestionTableBody.innerHTML = `
                <tr>
                    <td colspan="7" class="no-data">
                        <i class='bx bx-message-square-x'></i>
                        <p>No suggestions found</p>
                    </td>
                </tr>
            `;
            return;
        }

        const startIndex = (currentSuggestionPage - 1) * suggestionsPerPage;
        const endIndex = startIndex + suggestionsPerPage;
        const paginatedSuggestions = suggestions.slice(startIndex, endIndex);

        paginatedSuggestions.forEach(suggestion => {
            try {
                const row = document.createElement('tr');

                let statusClass = '';
                let statusText = suggestion.suggestionStatus || 'PENDING';

                switch(statusText.toLowerCase()) {
                    case 'approved':
                        statusClass = 'status-approved';
                        break;
                    case 'pending':
                        statusClass = 'status-pending';
                        break;
                    case 'rejected':
                        statusClass = 'status-rejected';
                        break;
                    default:
                        statusClass = 'status-pending';
                }

                // ‚úÖ FIXED: User ka naam properly show karo
                const userName = suggestion.user ? (suggestion.user.name || suggestion.user.fullName || 'Unknown User') : 'Unknown User';
                const userEmail = suggestion.user ? suggestion.user.email : 'N/A';

                row.innerHTML = `
                    <td>
                        <strong>${suggestion.suggestedTitle || 'Untitled'}</strong>
                    </td>
                    <td>${suggestion.author || 'Not specified'}</td>
                    <td>
                        <div class="user-avatar">
                            <i class='bx bx-user'></i>
                            <div>
                                <div>${userName}</div>
                                <small style="color: var(--gray);">${userEmail}</small>
                            </div>
                        </div>
                    </td>
                    <td>
                        ${suggestion.suggestionReason ?
                            `<div class="suggestion-reason">${suggestion.suggestionReason}</div>` :
                            '<span style="color: var(--gray); font-style: italic;">No reason provided</span>'
                        }
                    </td>
                    <td>
                        <span class="status-badge ${statusClass}">${statusText.toUpperCase()}</span>
                    </td>
                    <td>${formatDate(suggestion.createdAt)}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-info" onclick="viewSuggestion(${suggestion.id})" title="View Details">
                                <i class='bx bx-show'></i> View
                            </button>
                            ${suggestion.suggestionStatus === 'PENDING' ? `
                                <button class="btn-success" onclick="showSuggestionApprovalModal(${suggestion.id})" title="Approve Suggestion">
                                    <i class='bx bx-check'></i> Approve
                                </button>
                                <button class="btn-danger" onclick="showSuggestionRejectionModal(${suggestion.id})" title="Reject Suggestion">
                                    <i class='bx bx-x'></i> Reject
                                </button>
                            ` : ''}
                            <button class="btn-warning" onclick="editSuggestion(${suggestion.id})" title="Edit Suggestion">
                                <i class='bx bx-edit'></i> Edit
                            </button>
                            <button class="btn-danger" onclick="deleteSuggestion(${suggestion.id})" title="Delete Suggestion">
                                <i class='bx bx-trash'></i> Delete
                            </button>
                        </div>
                    </td>
                `;

                suggestionTableBody.appendChild(row);
            } catch (error) {
                console.error('Error rendering suggestion row:', error, suggestion);
            }
        });
    }

    function updateSuggestionPagination(totalPages, currentPage) {
        const pagination = document.getElementById('suggestionPagination');
        if (!pagination) return;

        let paginationHTML = '';

        if (currentPage > 1) {
            paginationHTML += `<button class="page-btn" onclick="loadSuggestions(${currentPage - 1})">Previous</button>`;
        }

        for (let i = 1; i <= totalPages; i++) {
            if (i === currentPage) {
                paginationHTML += `<button class="page-btn active">${i}</button>`;
            } else {
                paginationHTML += `<button class="page-btn" onclick="loadSuggestions(${i})">${i}</button>`;
            }
        }

        if (currentPage < totalPages) {
            paginationHTML += `<button class="page-btn" onclick="loadSuggestions(${currentPage + 1})">Next</button>`;
        }

        pagination.innerHTML = paginationHTML;
    }

    async function viewSuggestion(suggestionId) {
        try {
            const response = await fetch(`/suggestion/apis/findById/${suggestionId}`);

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const data = await response.json();

            if (data) {
                showSuggestionModal(data);
            } else {
                showNotification('Error loading suggestion details', 'error');
            }
        } catch (error) {
            console.error('Error viewing suggestion:', error);
            showNotification('Error loading suggestion details', 'error');
        }
    }

    function showSuggestionModal(suggestion) {
        const modal = document.getElementById('suggestionModal');
        const suggestionDetails = document.getElementById('suggestionDetails');

        if (modal && suggestionDetails) {
            const statusText = suggestion.suggestionStatus || 'PENDING';
            const statusClass = `status-${statusText.toLowerCase()}`;

            // ‚úÖ FIXED: User ka naam properly show karo
            const userName = suggestion.user ? (suggestion.user.name || suggestion.user.fullName || 'Unknown User') : 'Unknown User';
            const userEmail = suggestion.user ? suggestion.user.email : 'N/A';

            suggestionDetails.innerHTML = `
                <div class="book-detail-grid">
                    <div class="book-info">
                        <h3>${suggestion.suggestedTitle || 'Untitled'}</h3>
                        <p class="book-author">by ${suggestion.author || 'Not specified'}</p>

                        <div class="book-meta">
                            <span class="status-badge ${statusClass}">${statusText.toUpperCase()}</span>
                        </div>

                        <div style="margin: 1rem 0; padding: 1rem; background: #f8f9fa; border-radius: 6px;">
                            <strong>Suggested by:</strong> ${userName} (${userEmail})
                        </div>

                        ${suggestion.suggestionReason ? `
                        <div class="book-description">
                            <h4>Suggestion Reason</h4>
                            <div class="suggestion-reason">${suggestion.suggestionReason}</div>
                        </div>
                        ` : ''}

                        ${suggestion.adminNotes ? `
                        <div class="book-description">
                            <h4>Admin Notes</h4>
                            <div class="admin-notes">${suggestion.adminNotes}</div>
                        </div>
                        ` : ''}

                        <div class="book-stats">
                            <div class="stat">
                                <label>Submitted:</label>
                                <span>${suggestion.createdAt ? formatDateTime(suggestion.createdAt) : 'Unknown'}</span>
                            </div>
                            ${suggestion.updatedAt ? `
                            <div class="stat">
                                <label>Last Updated:</label>
                                <span>${formatDateTime(suggestion.updatedAt)}</span>
                            </div>
                            ` : ''}
                        </div>
                    </div>
                </div>
                <div class="modal-actions">
                    ${suggestion.suggestionStatus === 'PENDING' ? `
                        <button class="btn-success" onclick="showSuggestionApprovalModal(${suggestion.id})">
                            <i class='bx bx-check'></i> Approve
                        </button>
                        <button class="btn-danger" onclick="showSuggestionRejectionModal(${suggestion.id})">
                            <i class='bx bx-x'></i> Reject
                        </button>
                    ` : ''}
                    <button class="btn-primary" onclick="editSuggestion(${suggestion.id})">
                        <i class='bx bx-edit'></i> Edit
                    </button>
                    <button class="btn-danger" onclick="deleteSuggestion(${suggestion.id})">
                        <i class='bx bx-trash'></i> Delete
                    </button>
                </div>
            `;

            modal.style.display = 'block';
        }
    }

    function showSuggestionApprovalModal(suggestionId) {
        currentApproveSuggestionId = suggestionId;
        const modal = document.getElementById('suggestionApprovalModal');
        if (modal) {
            modal.style.display = 'block';
            document.getElementById('approvalNotes').value = '';
        }
    }

    function closeSuggestionApprovalModal() {
        const modal = document.getElementById('suggestionApprovalModal');
        if (modal) {
            modal.style.display = 'none';
            currentApproveSuggestionId = null;
        }
    }

    function showSuggestionRejectionModal(suggestionId) {
        currentRejectSuggestionId = suggestionId;
        const modal = document.getElementById('suggestionRejectionModal');
        if (modal) {
            modal.style.display = 'block';
            document.getElementById('rejectionNotes').value = '';
        }
    }

    function closeSuggestionRejectionModal() {
        const modal = document.getElementById('suggestionRejectionModal');
        if (modal) {
            modal.style.display = 'none';
            currentRejectSuggestionId = null;
        }
    }

    document.getElementById('suggestionApprovalForm').addEventListener('submit', async function(e) {
        e.preventDefault();

        if (!currentApproveSuggestionId) return;

        const adminNotes = document.getElementById('approvalNotes').value;

        if (confirm('Are you sure you want to approve this suggestion?')) {
            await approveSuggestion(currentApproveSuggestionId, adminNotes);
        }
    });

    document.getElementById('suggestionRejectionForm').addEventListener('submit', async function(e) {
        e.preventDefault();

        if (!currentRejectSuggestionId) return;

        const rejectionNotes = document.getElementById('rejectionNotes').value;

        if (!rejectionNotes.trim()) {
            showNotification('Please provide a reason for rejection', 'error');
            return;
        }

        if (confirm('Are you sure you want to reject this suggestion?')) {
            await rejectSuggestion(currentRejectSuggestionId, rejectionNotes);
        }
    });

    async function approveSuggestion(suggestionId, adminNotes) {
        try {
            showNotification('Approving suggestion...', 'info');

            const response = await fetch(`/suggestion/apis/admin/approve/${suggestionId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ adminNotes: adminNotes })
            });

            const data = await response.json();

            if (response.ok) {
                showNotification('‚úÖ Suggestion approved successfully!', 'success');
                loadSuggestions(currentSuggestionPage);
                loadDashboardSummary();
                closeSuggestionApprovalModal();

                const modal = document.getElementById('suggestionModal');
                if (modal) modal.style.display = 'none';
            } else {
                showNotification('‚ùå Error: ' + data, 'error');
            }
        } catch (error) {
            console.error('Error approving suggestion:', error);
            showNotification('‚ùå Error approving suggestion', 'error');
        }
    }

    async function rejectSuggestion(suggestionId, adminNotes) {
        try {
            showNotification('Rejecting suggestion...', 'info');

            const response = await fetch(`/suggestion/apis/admin/reject/${suggestionId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ adminNotes: adminNotes })
            });

            const data = await response.json();

            if (response.ok) {
                showNotification('‚úÖ Suggestion rejected successfully!', 'success');
                loadSuggestions(currentSuggestionPage);
                loadDashboardSummary();
                closeSuggestionRejectionModal();

                const modal = document.getElementById('suggestionModal');
                if (modal) modal.style.display = 'none';
            } else {
                showNotification('‚ùå Error: ' + data, 'error');
            }
        } catch (error) {
            console.error('Error rejecting suggestion:', error);
            showNotification('‚ùå Error rejecting suggestion', 'error');
        }
    }

    async function editSuggestion(suggestionId) {
        showNotification('Edit suggestion functionality coming soon!', 'info');
    }

    async function deleteSuggestion(suggestionId) {
        const suggestion = allSuggestions.find(s => s.id == suggestionId);
        if (!suggestion) return;

        if (confirm(`‚ö†Ô∏è ARE YOU SURE YOU WANT TO DELETE SUGGESTION "${suggestion.suggestedTitle}"?\n\nThis action cannot be undone!`)) {
            try {
                showNotification('Deleting suggestion...', 'warning');

                const response = await fetch(`/suggestion/apis/delete/${suggestionId}`, {
                    method: 'DELETE'
                });

                const data = await response.json();

                if (response.ok) {
                    showNotification('‚úÖ Suggestion deleted successfully!', 'success');
                    loadSuggestions(currentSuggestionPage);
                    loadDashboardSummary();

                    const modal = document.getElementById('suggestionModal');
                    if (modal) modal.style.display = 'none';
                } else {
                    showNotification('‚ùå Error: ' + data, 'error');
                }
            } catch (error) {
                console.error('Error deleting suggestion:', error);
                showNotification('‚ùå Error deleting suggestion', 'error');
            }
        }
    }

    function searchSuggestions() {
        const searchTerm = document.getElementById('suggestionSearch').value.toLowerCase();
        const rows = document.querySelectorAll('#suggestionTableBody tr');

        rows.forEach(row => {
            const text = row.textContent.toLowerCase();
            row.style.display = text.includes(searchTerm) ? '' : 'none';
        });
    }

    function filterSuggestions() {
        const statusFilter = document.getElementById('suggestionStatusFilter').value;
        const rows = document.querySelectorAll('#suggestionTableBody tr');

        rows.forEach(row => {
            if (!statusFilter) {
                row.style.display = '';
                return;
            }

            const statusBadge = row.querySelector('.status-badge');
            if (statusBadge && statusBadge.textContent.toLowerCase().includes(statusFilter.toLowerCase())) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        });
    }

    async function exportSuggestions() {
        try {
            showNotification('Preparing suggestion export...', 'info');

            const response = await fetch('/suggestion/apis/admin/all');
            const data = await response.json();

            if (Array.isArray(data)) {
                const csv = convertSuggestionsToCSV(data);
                downloadCSV(csv, 'intelliread-suggestions.csv');
                showNotification('Suggestions exported successfully!', 'success');
            } else {
                showNotification('Error exporting suggestions', 'error');
            }
        } catch (error) {
            console.error('Error exporting suggestions:', error);
            showNotification('Error exporting suggestions', 'error');
        }
    }

    function convertSuggestionsToCSV(suggestions) {
        const headers = ['Title', 'Author', 'User', 'Reason', 'Status', 'Submitted Date', 'Admin Notes'];

        const rows = suggestions.map(suggestion => [
            suggestion.suggestedTitle,
            suggestion.author || 'Not specified',
            suggestion.user ? (suggestion.user.name || suggestion.user.fullName || 'Unknown') : 'Unknown',
            suggestion.suggestionReason || 'No reason provided',
            suggestion.suggestionStatus || 'PENDING',
            new Date(suggestion.createdAt).toLocaleDateString(),
            suggestion.adminNotes || 'No notes'
        ]);

        return [headers, ...rows].map(row => row.map(field => `"${field}"`).join(',')).join('\n');
    }

    function showDemoSuggestions() {
        const suggestionTableBody = document.getElementById('suggestionTableBody');
        if (!suggestionTableBody) return;

        const demoSuggestions = [
            {
                id: 1,
                suggestedTitle: 'The Great Gatsby',
                author: 'F. Scott Fitzgerald',
                suggestionReason: 'Classic literature that should be available',
                suggestionStatus: 'PENDING',
                createdAt: new Date().toISOString(),
                user: { name: 'John Doe', email: 'john@example.com' }
            },
            {
                id: 2,
                suggestedTitle: 'To Kill a Mockingbird',
                author: 'Harper Lee',
                suggestionReason: 'Important for educational purposes',
                suggestionStatus: 'APPROVED',
                createdAt: new Date(Date.now() - 86400000).toISOString(),
                user: { name: 'Jane Smith', email: 'jane@example.com' }
            }
        ];

        allSuggestions = demoSuggestions;
        displaySuggestions(demoSuggestions);
    }

    // ===== ANALYTICS FUNCTIONS =====
    async function loadAnalytics() {
        try {
            const response = await fetch('/api/admin/analytics');

            if (response.ok) {
                const data = await response.json();
                if (data.success) {
                    console.log('Analytics data loaded:', data);
                }
            }
        } catch (error) {
            console.error('Error loading analytics:', error);
        }
    }

    // ===== EXPORT FUNCTIONALITY =====
    async function exportUsers() {
        try {
            showNotification('Preparing user export...', 'info');

            const response = await fetch('/api/admin/users?limit=1000');
            const data = await response.json();

            if (data.success) {
                const csv = convertToCSV(data.users);
                downloadCSV(csv, 'intelliread-users.csv');
                showNotification('Users exported successfully!', 'success');
            } else {
                showNotification('Error exporting users: ' + data.message, 'error');
            }
        } catch (error) {
            console.error('Error exporting users:', error);
            showNotification('Error exporting users', 'error');
        }
    }

    function convertToCSV(users) {
        const headers = ['Name', 'Email', 'Role', 'Status', 'Joined Date'];
        const rows = users.map(user => [
            user.fullName,
            user.email,
            user.role,
            user.role === 'publisher' ? (user.isApproved ? 'Approved Publisher' : 'Pending Approval') : 'Active User',
            new Date(user.createdAt).toLocaleDateString()
        ]);

        return [headers, ...rows].map(row => row.map(field => `"${field}"`).join(',')).join('\n');
    }

    function downloadCSV(csv, filename) {
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        a.click();
        window.URL.revokeObjectURL(url);
    }

    // ===== SETTINGS FUNCTIONS =====
    function saveSettings() {
        showNotification('Settings saved successfully!', 'success');
    }

    // ===== LOGOUT FUNCTIONALITY =====
    function showLogoutConfirmation() {
        const modal = document.getElementById('logoutModal');
        if (modal) {
            modal.style.display = 'block';
        }
    }

    function closeLogoutModal() {
    const modal = document.getElementById('logoutModal');
    if (modal) {
        modal.style.display = 'none';
    }
}

    // ===== QUICK LOGOUT FUNCTION =====
async function confirmLogout() {
    // Step 1: Immediate session clear
    sessionStorage.removeItem('admin');
    sessionStorage.removeItem('isAdmin');
    localStorage.removeItem('admin');

    // Step 2: Show instant notification
    showNotification('Logged out successfully!', 'success');

    // Step 3: Non-blocking server logout (background mein)
    fetch('/admin/logout', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' }
    }).catch(err => console.log('Background logout completed'));

    // Step 4: Immediate redirect (no delay)
    setTimeout(() => {
        window.location.href = '/admin-login';
    }, 10);
}

    // ===== NOTIFICATION SYSTEM =====
    function showNotification(message, type = 'info') {
        const existingNotifications = document.querySelectorAll('.notification');
        existingNotifications.forEach(notification => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        });

        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.innerHTML = `
            <div class="notification-content">
                <i class='bx ${getNotificationIcon(type)}'></i>
                <span>${message}</span>
            </div>
        `;

        document.body.appendChild(notification);

        setTimeout(() => {
            notification.classList.add('show');
        }, 100);

        setTimeout(() => {
            notification.classList.remove('show');
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 300);
        }, 5000);
    }

    function getNotificationIcon(type) {
        const icons = {
            'success': 'bx-check-circle',
            'error': 'bx-error-circle',
            'warning': 'bx-error',
            'info': 'bx-info-circle'
        };
        return icons[type] || 'bx-info-circle';
    }

    function showLoading(show) {
        const loadingOverlay = document.getElementById('globalLoading');
        if (loadingOverlay) {
            if (show) {
                loadingOverlay.classList.add('active');
            } else {
                loadingOverlay.classList.remove('active');
            }
        }
    }

    // ===== EVENT LISTENERS SETUP =====
    function setupEventListeners() {
        const closeButtons = document.querySelectorAll('.close');
        closeButtons.forEach(button => {
            button.addEventListener('click', function() {
                const modal = this.closest('.modal');
                if (modal) {
                    modal.style.display = 'none';
                }
            });
        });

        window.addEventListener('click', function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        });

        let searchTimeout;
        const userSearch = document.getElementById('userSearch');
        const bookSearch = document.getElementById('bookSearch');
        const suggestionSearch = document.getElementById('suggestionSearch');

        if (userSearch) {
            userSearch.addEventListener('input', function() {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(searchUsers, 300);
            });
        }

        if (bookSearch) {
            bookSearch.addEventListener('input', function() {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(searchBooks, 300);
            });
        }

        if (suggestionSearch) {
            suggestionSearch.addEventListener('input', function() {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(searchSuggestions, 300);
            });
        }
    }

    // ===== UTILITY FUNCTIONS =====
    function formatDate(dateString) {
        if (!dateString) return 'Unknown';
        return new Date(dateString).toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'short',
            day: 'numeric'
        });
    }

    function formatDateTime(dateString) {
        if (!dateString) return 'Unknown';
        try {
            const date = new Date(dateString);
            if (isNaN(date.getTime())) {
                return 'Invalid Date';
            }
            return date.toLocaleString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        } catch (error) {
            console.error('Error formatting date:', error);
            return 'Date Error';
        }
    }

    // ===== GLOBAL FUNCTION EXPORTS =====
    window.showSection = showSection;
    window.loadUsers = loadUsers;
    window.loadBooks = loadBooks;
    window.loadSuggestions = loadSuggestions;
    window.searchUsers = searchUsers;
    window.searchBooks = searchBooks;
    window.searchSuggestions = searchSuggestions;
    window.filterBooks = filterBooks;
    window.filterSuggestions = filterSuggestions;
    window.approvePublisher = approvePublisher;
    window.rejectPublisher = rejectPublisher;
    window.viewUser = viewUser;
    window.editUser = editUser;
    window.deleteUser = deleteUser;
    window.approveBook = approveBook;
    window.showRejectionModal = showRejectionModal;
    window.closeRejectionModal = closeRejectionModal;
    window.rejectBook = rejectBook;
    window.viewBook = viewBook;
    window.editBook = editBook;
    window.featureBook = featureBook;
    window.unfeatureBook = unfeatureBook;
    window.deleteBook = deleteBook;
    window.viewSuggestion = viewSuggestion;
    window.showSuggestionApprovalModal = showSuggestionApprovalModal;
    window.closeSuggestionApprovalModal = closeSuggestionApprovalModal;
    window.showSuggestionRejectionModal = showSuggestionRejectionModal;
    window.closeSuggestionRejectionModal = closeSuggestionRejectionModal;
    window.editSuggestion = editSuggestion;
    window.deleteSuggestion = deleteSuggestion;
    window.exportUsers = exportUsers;
    window.exportSuggestions = exportSuggestions;
    window.saveSettings = saveSettings;
    window.showLogoutConfirmation = showLogoutConfirmation;
    window.closeLogoutModal = closeLogoutModal;
    window.confirmLogout = confirmLogout;
</script>
</body>
</html>