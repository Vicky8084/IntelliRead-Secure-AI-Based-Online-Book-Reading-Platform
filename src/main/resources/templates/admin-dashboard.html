<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard | Intelli-Read</title>
    <link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
    <style>
        * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
          font-family: "Chakra Petch", sans-serif;
        }

        :root {
          --primary: #4361ee;
          --secondary: #3a0ca3;
          --success: #4cc9f0;
          --warning: #f72585;
          --info: #7209b7;
          --dark: #2b2d42;
          --light: #f8f9fa;
          --gray: #6c757d;
          --border: #e9ecef;
        }

        body {
          background: #f5f7fb;
          color: var(--dark);
          overflow-x: hidden;
        }

        /* Header */
        .admin-header {
          background: linear-gradient(135deg, var(--primary), var(--secondary));
          color: white;
          padding: 1rem 2rem;
          box-shadow: 0 2px 10px rgba(0,0,0,0.1);
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          z-index: 1000;
        }

        .header-content {
          display: flex;
          justify-content: space-between;
          align-items: center;
        }

        .header-left h1 {
          font-size: 1.5rem;
          font-weight: 600;
        }

        .admin-info {
          display: flex;
          align-items: center;
          gap: 1rem;
        }

        .logout-btn {
          background: linear-gradient(135deg, #df1e1e, #ff6b6b);
          color: white;
          border: none;
          padding: 10px 20px;
          border-radius: 6px;
          cursor: pointer;
          font-weight: 500;
          transition: all 0.3s ease;
          display: flex;
          align-items: center;
          gap: 8px;
        }

        .logout-btn:hover {
          background: linear-gradient(135deg, #ee5a52, #e53e3e);
          transform: translateY(-2px);
          box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
        }

        /* Main Container */
        .admin-container {
          display: flex;
          margin-top: 70px;
          min-height: calc(100vh - 70px);
        }

        /* Sidebar */
        .sidebar {
          width: 260px;
          background: white;
          box-shadow: 2px 0 10px rgba(0,0,0,0.1);
          height: calc(100vh - 70px);
          position: fixed;
          overflow-y: auto;
        }

        .sidebar-header {
          padding: 2rem 1.5rem;
          border-bottom: 1px solid var(--border);
        }

        .sidebar-header h2 {
          color: var(--primary);
          font-size: 1.3rem;
        }

        .sidebar-menu {
          list-style: none;
          padding: 1rem 0;
        }

        .menu-item {
          padding: 1rem 1.5rem;
          display: flex;
          align-items: center;
          gap: 1rem;
          cursor: pointer;
          transition: all 0.3s ease;
          border-left: 3px solid transparent;
        }

        .menu-item:hover {
          background: #f8f9fa;
          color: var(--primary);
        }

        .menu-item.active {
          background: linear-gradient(90deg, rgba(67, 97, 238, 0.1), transparent);
          color: var(--primary);
          border-left-color: var(--primary);
        }

        .menu-item i {
          font-size: 1.2rem;
        }

        /* Main Content */
        .main-content {
          flex: 1;
          margin-left: 260px;
          padding: 2rem;
        }

        .section {
          display: none;
        }

        .section.active {
          display: block;
          animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
          from { opacity: 0; transform: translateY(20px); }
          to { opacity: 1; transform: translateY(0); }
        }

        .section-header {
          margin-bottom: 2rem;
        }

        .section-header h1 {
          font-size: 2rem;
          color: var(--dark);
          margin-bottom: 0.5rem;
        }

        .section-header p {
          color: var(--gray);
        }

        .header-actions {
          display: flex;
          gap: 1rem;
          align-items: center;
          margin-top: 1rem;
        }

        /* Stats Grid */
        .stats-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
          gap: 1.5rem;
          margin-bottom: 2rem;
        }

        .stat-card {
          background: white;
          padding: 1.5rem;
          border-radius: 12px;
          box-shadow: 0 4px 6px rgba(0,0,0,0.05);
          display: flex;
          align-items: center;
          gap: 1rem;
          transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .stat-card:hover {
          transform: translateY(-5px);
          box-shadow: 0 8px 15px rgba(0,0,0,0.1);
        }

        .stat-card.primary { border-left: 4px solid var(--primary); }
        .stat-card.success { border-left: 4px solid var(--success); }
        .stat-card.warning { border-left: 4px solid var(--warning); }
        .stat-card.info { border-left: 4px solid var(--info); }
        .stat-card.secondary { border-left: 4px solid #6c757d; }
        .stat-card.danger { border-left: 4px solid #dc3545; }

        .stat-icon {
          width: 60px;
          height: 60px;
          border-radius: 12px;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 1.5rem;
          color: white;
        }

        .stat-card.primary .stat-icon { background: var(--primary); }
        .stat-card.success .stat-icon { background: var(--success); }
        .stat-card.warning .stat-icon { background: var(--warning); }
        .stat-card.info .stat-icon { background: var(--info); }
        .stat-card.secondary .stat-icon { background: #6c757d; }
        .stat-card.danger .stat-icon { background: #dc3545; }

        .stat-info h3 {
          font-size: 2rem;
          margin-bottom: 0.5rem;
        }

        .stat-info p {
          color: var(--gray);
          font-size: 0.9rem;
        }

        /* Search Box */
        .search-box {
          position: relative;
          flex: 1;
          max-width: 300px;
        }

        .search-box i {
          position: absolute;
          left: 1rem;
          top: 50%;
          transform: translateY(-50%);
          color: var(--gray);
        }

        .search-box input {
          width: 100%;
          padding: 0.75rem 1rem 0.75rem 2.5rem;
          border: 1px solid var(--border);
          border-radius: 8px;
          outline: none;
          transition: border-color 0.3s ease;
        }

        .search-box input:focus {
          border-color: var(--primary);
        }

        /* Buttons */
        .btn-primary {
          background: var(--primary);
          color: white;
          border: none;
          padding: 0.75rem 1.5rem;
          border-radius: 8px;
          cursor: pointer;
          display: flex;
          align-items: center;
          gap: 0.5rem;
          transition: all 0.3s ease;
        }

        .btn-primary:hover {
          background: var(--secondary);
          transform: translateY(-2px);
        }

        /* Enhanced Button Styles */
        .btn-success {
          background: linear-gradient(135deg, #28a745, #20c997);
          color: white;
          border: none;
          padding: 8px 16px;
          border-radius: 6px;
          cursor: pointer;
          font-weight: 500;
          transition: all 0.3s ease;
          display: inline-flex;
          align-items: center;
          gap: 6px;
          margin: 0 4px;
        }

        .btn-success:hover {
          background: linear-gradient(135deg, #218838, #1e7e34);
          transform: translateY(-2px);
          box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
        }

        .btn-danger {
          background: linear-gradient(135deg, #dc3545, #e83e8c);
          color: white;
          border: none;
          padding: 8px 16px;
          border-radius: 6px;
          cursor: pointer;
          font-weight: 500;
          transition: all 0.3s ease;
          display: inline-flex;
          align-items: center;
          gap: 6px;
          margin: 0 4px;
        }

        .btn-danger:hover {
          background: linear-gradient(135deg, #c82333, #d91a7a);
          transform: translateY(-2px);
          box-shadow: 0 4px 12px rgba(220, 53, 69, 0.3);
        }

        .btn-info {
          background: linear-gradient(135deg, #17a2b8, #6f42c1);
          color: white;
          border: none;
          padding: 8px 16px;
          border-radius: 6px;
          cursor: pointer;
          font-weight: 500;
          transition: all 0.3s ease;
          display: inline-flex;
          align-items: center;
          gap: 6px;
          margin: 0 4px;
        }

        .btn-info:hover {
          background: linear-gradient(135deg, #138496, #5a2d9c);
          transform: translateY(-2px);
          box-shadow: 0 4px 12px rgba(23, 162, 184, 0.3);
        }

        .btn-warning {
          background: linear-gradient(135deg, #ffc107, #fd7e14);
          color: white;
          border: none;
          padding: 8px 16px;
          border-radius: 6px;
          cursor: pointer;
          font-weight: 500;
          transition: all 0.3s ease;
          display: inline-flex;
          align-items: center;
          gap: 6px;
          margin: 0 4px;
        }

        .btn-warning:hover {
          background: linear-gradient(135deg, #e0a800, #e55a00);
          transform: translateY(-2px);
          box-shadow: 0 4px 12px rgba(255, 193, 7, 0.3);
        }

        .btn-secondary {
          background: linear-gradient(135deg, #6c757d, #495057);
          color: white;
          border: none;
          padding: 8px 16px;
          border-radius: 6px;
          cursor: pointer;
          font-weight: 500;
          transition: all 0.3s ease;
          display: inline-flex;
          align-items: center;
          gap: 6px;
          margin: 0 4px;
        }

        .btn-secondary:hover {
          background: linear-gradient(135deg, #5a6268, #343a40);
          transform: translateY(-2px);
          box-shadow: 0 4px 12px rgba(108, 117, 125, 0.3);
        }

        .action-buttons {
          display: flex;
          gap: 8px;
          flex-wrap: wrap;
        }

        /* Tables */
        .table-container {
          background: white;
          border-radius: 12px;
          box-shadow: 0 4px 6px rgba(0,0,0,0.05);
          overflow: hidden;
        }

        table {
          width: 100%;
          border-collapse: collapse;
        }

        th, td {
          padding: 1rem;
          text-align: left;
          border-bottom: 1px solid var(--border);
        }

        th {
          background: #f8f9fa;
          font-weight: 600;
          color: var(--dark);
        }

        tr:hover {
          background: #f8f9fa;
        }

        /* Status Badges */
        .status-badge {
          padding: 0.3rem 0.8rem;
          border-radius: 20px;
          font-size: 0.8rem;
          font-weight: 500;
        }

        .status-pending { background: #fff3cd; color: #856404; }
        .status-approved { background: #d1edff; color: #004085; }
        .status-rejected { background: #f8d7da; color: #721c24; }
        .status-active { background: #d4edda; color: #155724; }
        .status-inactive { background: #e2e3e5; color: #383d41; }

        /* Pagination */
        .pagination {
          display: flex;
          justify-content: center;
          align-items: center;
          gap: 0.5rem;
          margin-top: 2rem;
        }

        .pagination button {
          padding: 0.5rem 1rem;
          border: 1px solid var(--border);
          background: white;
          cursor: pointer;
          border-radius: 6px;
          transition: all 0.3s ease;
        }

        .pagination button.active {
          background: var(--primary);
          color: white;
          border-color: var(--primary);
        }

        .pagination button:hover:not(.active) {
          background: #f8f9fa;
        }

        /* Modal */
        .modal {
          display: none;
          position: fixed;
          z-index: 2000;
          left: 0;
          top: 0;
          width: 100%;
          height: 100%;
          background: rgba(0,0,0,0.5);
        }

        .modal-content {
          background: white;
          margin: 5% auto;
          padding: 2rem;
          border-radius: 12px;
          width: 90%;
          max-width: 500px;
          position: relative;
          animation: modalSlide 0.3s ease;
        }

        .modal-content.large {
          max-width: 700px;
        }

        @keyframes modalSlide {
          from { transform: translateY(-50px); opacity: 0; }
          to { transform: translateY(0); opacity: 1; }
        }

        .close {
          position: absolute;
          right: 1rem;
          top: 1rem;
          font-size: 1.5rem;
          cursor: pointer;
          color: var(--gray);
        }

        .close:hover {
          color: var(--dark);
        }

        /* Activity Section */
        .activity-section {
          background: white;
          border-radius: 12px;
          padding: 1.5rem;
          box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        .activity-list {
          margin-top: 1rem;
        }

        .activity-item {
          display: flex;
          align-items: center;
          gap: 1rem;
          padding: 1rem 0;
          border-bottom: 1px solid var(--border);
        }

        .activity-item:last-child {
          border-bottom: none;
        }

        .activity-icon {
          width: 40px;
          height: 40px;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          color: white;
        }

        .activity-icon.user { background: var(--primary); }
        .activity-icon.book { background: var(--success); }
        .activity-icon.system { background: var(--warning); }

        /* Analytics Grid */
        .analytics-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
          gap: 1.5rem;
        }

        .chart-card {
          background: white;
          padding: 1.5rem;
          border-radius: 12px;
          box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        .chart-placeholder {
          height: 300px;
          background: #f8f9fa;
          border-radius: 8px;
          display: flex;
          align-items: center;
          justify-content: center;
          color: var(--gray);
          margin-top: 1rem;
        }

        /* Settings */
        .settings-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
          gap: 1.5rem;
        }

        .setting-card {
          background: white;
          padding: 1.5rem;
          border-radius: 12px;
          box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        .setting-item {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 1rem 0;
          border-bottom: 1px solid var(--border);
        }

        .setting-item:last-child {
          border-bottom: none;
        }

        .setting-item label {
          font-weight: 500;
        }

        .setting-item input {
          padding: 0.5rem;
          border: 1px solid var(--border);
          border-radius: 6px;
          width: 200px;
        }

        /* Switch */
        .switch {
          position: relative;
          display: inline-block;
          width: 50px;
          height: 24px;
        }

        .switch input {
          opacity: 0;
          width: 0;
          height: 0;
        }

        .slider {
          position: absolute;
          cursor: pointer;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background: #ccc;
          transition: .4s;
          border-radius: 24px;
        }

        .slider:before {
          position: absolute;
          content: "";
          height: 16px;
          width: 16px;
          left: 4px;
          bottom: 4px;
          background: white;
          transition: .4s;
          border-radius: 50%;
        }

        input:checked + .slider {
          background: var(--primary);
        }

        input:checked + .slider:before {
          transform: translateX(26px);
        }

        /* Book cover styles */
        .book-cover {
          width: 40px;
          height: 60px;
          object-fit: cover;
          border-radius: 4px;
        }

        .book-cover-placeholder {
          width: 40px;
          height: 60px;
          background: #f8f9fa;
          border-radius: 4px;
          display: flex;
          align-items: center;
          justify-content: center;
          color: #6c757d;
        }

        /* Loading states */
        .loading-cell {
          text-align: center;
          padding: 2rem;
          color: var(--gray);
        }

        .loading-spinner {
          width: 30px;
          height: 30px;
          border: 3px solid #f3f3f3;
          border-top: 3px solid var(--primary);
          border-radius: 50%;
          animation: spin 1s linear infinite;
          margin: 0 auto 1rem;
        }

        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }

        .no-data {
          text-align: center;
          padding: 3rem;
          color: var(--gray);
        }

        .no-data i {
          font-size: 3rem;
          margin-bottom: 1rem;
          display: block;
        }

        /* User avatar */
        .user-avatar {
          display: flex;
          align-items: center;
          gap: 10px;
        }

        .user-avatar i {
          width: 32px;
          height: 32px;
          background: var(--primary);
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          color: white;
        }

        /* Category tags */
        .category-tag {
          background: #e9ecef;
          color: #495057;
          padding: 4px 8px;
          border-radius: 12px;
          font-size: 0.8rem;
          font-weight: 500;
        }

        /* Featured badge */
        .featured-badge {
          background: linear-gradient(135deg, #ffd700, #ffed4e);
          color: #856404;
          padding: 2px 6px;
          border-radius: 8px;
          font-size: 0.7rem;
          font-weight: 600;
          margin-left: 8px;
        }

        /* Book title styling */
        .book-title {
          display: flex;
          align-items: center;
          gap: 8px;
        }

        /* Modal improvements */
        .user-detail-grid {
          display: grid;
          gap: 1rem;
          margin-bottom: 1.5rem;
        }

        .user-detail {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 0.5rem 0;
          border-bottom: 1px solid var(--border);
        }

        .user-detail:last-child {
          border-bottom: none;
        }

        .user-detail label {
          font-weight: 600;
          color: var(--dark);
        }

        .role-badge {
          padding: 4px 8px;
          border-radius: 12px;
          font-size: 0.8rem;
          font-weight: 500;
          background: #e9ecef;
          color: #495057;
        }

        .role-badge.publisher {
          background: #d1edff;
          color: #004085;
        }

        .modal-actions {
          display: flex;
          gap: 1rem;
          justify-content: flex-end;
          margin-top: 1.5rem;
          padding-top: 1.5rem;
          border-top: 1px solid var(--border);
        }

        /* Book Modal Styles */
        .book-detail-grid {
          display: grid;
          grid-template-columns: 200px 1fr;
          gap: 2rem;
          margin-bottom: 1.5rem;
        }

        .book-cover-large img {
          max-width: 100%;
          border-radius: 8px;
          box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .book-info h3 {
          font-size: 1.5rem;
          margin-bottom: 0.5rem;
          color: var(--dark);
        }

        .book-author {
          color: var(--gray);
          font-size: 1.1rem;
          margin-bottom: 1rem;
        }

        .book-meta {
          margin-bottom: 1rem;
        }

        .book-description {
          margin-bottom: 1.5rem;
        }

        .book-description h4 {
          margin-bottom: 0.5rem;
          color: var(--dark);
        }

        .book-stats {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 0.5rem;
        }

        .stat {
          display: flex;
          justify-content: space-between;
          padding: 0.5rem 0;
          border-bottom: 1px solid var(--border);
        }

        .stat:last-child {
          border-bottom: none;
        }

        /* Notification system */
        .notification {
          position: fixed;
          top: 20px;
          right: 20px;
          padding: 15px 20px;
          border-radius: 8px;
          color: white;
          font-weight: 500;
          z-index: 10000;
          box-shadow: 0 4px 12px rgba(0,0,0,0.3);
          max-width: 300px;
          transform: translateX(400px);
          opacity: 0;
          transition: all 0.3s ease;
        }

        .notification.show {
          transform: translateX(0);
          opacity: 1;
        }

        .notification.success {
          background: linear-gradient(135deg, #28a745, #20c997);
        }

        .notification.error {
          background: linear-gradient(135deg, #dc3545, #e83e8c);
        }

        .notification.warning {
          background: linear-gradient(135deg, #ffc107, #fd7e14);
        }

        .notification.info {
          background: linear-gradient(135deg, #17a2b8, #6f42c1);
        }

        .notification-content {
          display: flex;
          align-items: center;
          gap: 10px;
        }

        .notification-content i {
          font-size: 1.2rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
          .sidebar {
            width: 100%;
            height: auto;
            position: relative;
          }

          .main-content {
            margin-left: 0;
          }

          .admin-container {
            flex-direction: column;
          }

          .stats-grid {
            grid-template-columns: 1fr;
          }

          .header-actions {
            flex-direction: column;
            align-items: stretch;
          }

          .search-box {
            max-width: none;
          }

          .book-detail-grid {
            grid-template-columns: 1fr;
            gap: 1rem;
          }

          .modal-content.large {
            margin: 10% auto;
            width: 95%;
          }

          .action-buttons {
            flex-direction: column;
            gap: 4px;
          }

          .modal-actions {
            flex-direction: column;
          }
        }

        /* Logout message styles */
        #logoutMessageContainer {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            z-index: 10000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            max-width: 300px;
            text-align: center;
            display: none;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
    </style>
</head>
<body>
<!-- Header -->
<header class="admin-header">
    <div class="header-content">
        <div class="header-left">
            <h1>ðŸ“š Intelli-Read Admin</h1>
        </div>
        <div class="header-right">
            <div class="admin-info">
                <span>Welcome, Admin</span>
                <button class="logout-btn" onclick="logout()">
                    <i class='bx bx-log-out'></i> Logout
                </button>
            </div>
        </div>
    </div>
</header>

<div class="admin-container">
    <!-- Sidebar -->
    <nav class="sidebar">
        <div class="sidebar-header">
            <h2>Admin Panel</h2>
        </div>
        <ul class="sidebar-menu">
            <li class="menu-item active" onclick="showSection('dashboard')">
                <i class='bx bx-dashboard'></i>
                <span>Dashboard</span>
            </li>
            <li class="menu-item" onclick="showSection('users')">
                <i class='bx bx-user'></i>
                <span>Manage Users</span>
            </li>
            <li class="menu-item" onclick="showSection('books')">
                <i class='bx bx-book'></i>
                <span>Manage Books</span>
            </li>
            <li class="menu-item" onclick="showSection('analytics')">
                <i class='bx bx-bar-chart'></i>
                <span>Analytics</span>
            </li>
            <li class="menu-item" onclick="showSection('settings')">
                <i class='bx bx-cog'></i>
                <span>Settings</span>
            </li>
        </ul>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Dashboard Section -->
        <section id="dashboard" class="section active">
            <div class="section-header">
                <h1>Dashboard Overview</h1>
                <p>Welcome to your admin dashboard</p>
            </div>

            <!-- Stats Cards -->
            <div class="stats-grid">
                <div class="stat-card primary">
                    <div class="stat-icon">
                        <i class='bx bx-user'></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalUsers">0</h3>
                        <p>Total Users</p>
                    </div>
                </div>

                <div class="stat-card success">
                    <div class="stat-icon">
                        <i class='bx bx-book'></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalBooks">0</h3>
                        <p>Total Books</p>
                    </div>
                </div>

                <div class="stat-card warning">
                    <div class="stat-icon">
                        <i class='bx bx-time'></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="pendingBooks">0</h3>
                        <p>Pending Approvals</p>
                    </div>
                </div>

                <div class="stat-card info">
                    <div class="stat-icon">
                        <i class='bx bx-bar-chart'></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="activeUsers">0</h3>
                        <p>Active Today</p>
                    </div>
                </div>
            </div>

            <!-- Additional Stats for Publishers -->
            <div class="stats-grid" style="margin-top: 20px;">
                <div class="stat-card secondary">
                    <div class="stat-icon">
                        <i class='bx bx-user-check'></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalPublishers">0</h3>
                        <p>Approved Publishers</p>
                    </div>
                </div>

                <div class="stat-card danger">
                    <div class="stat-icon">
                        <i class='bx bx-user-x'></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="pendingPublishers">0</h3>
                        <p>Pending Publishers</p>
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="activity-section">
                <div class="activity-card">
                    <h3>Recent Activity</h3>
                    <div class="activity-list" id="recentActivity">
                        <!-- Activity items will be loaded here -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Manage Users Section -->
        <section id="users" class="section">
            <div class="section-header">
                <h1>Manage Users</h1>
                <div class="header-actions">
                    <div class="search-box">
                        <i class='bx bx-search'></i>
                        <input type="text" id="userSearch" placeholder="Search users..." onkeyup="searchUsers()">
                    </div>
                    <button class="btn-primary" onclick="exportUsers()">
                        <i class='bx bx-export'></i> Export
                    </button>
                </div>
            </div>

            <div class="table-container">
                <table id="userTable">
                    <thead>
                    <tr>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Role</th>
                        <th>Status</th>
                        <th>Joined</th>
                        <th>Actions</th>
                    </tr>
                    </thead>
                    <tbody id="userTableBody">
                    <!-- Users will be loaded here -->
                    </tbody>
                </table>
            </div>

            <div class="pagination" id="userPagination">
                <!-- Pagination will be loaded here -->
            </div>
        </section>

        <!-- Manage Books Section -->
        <section id="books" class="section">
            <div class="section-header">
                <h1>Manage Books</h1>
                <p>Review and manage books submitted by publishers</p>
                <div class="header-actions">
                    <div class="search-box">
                        <i class='bx bx-search'></i>
                        <input type="text" id="bookSearch" placeholder="Search books..." onkeyup="searchBooks()">
                    </div>
                    <select id="statusFilter" onchange="filterBooks()">
                        <option value="">All Status</option>
                        <option value="pending">Pending</option>
                        <option value="approved">Approved</option>
                        <option value="rejected">Rejected</option>
                    </select>
                </div>
            </div>

            <div class="table-container">
                <table id="bookTable">
                    <thead>
                    <tr>
                        <th>Cover</th>
                        <th>Title & Author</th>
                        <th>Category</th>
                        <th>Publisher</th>
                        <th>Status</th>
                        <th>Submitted</th>
                        <th>Actions</th>
                    </tr>
                    </thead>
                    <tbody id="bookTableBody">
                    <!-- Books will be loaded here -->
                    </tbody>
                </table>
            </div>

            <div class="pagination" id="bookPagination">
                <!-- Pagination will be loaded here -->
            </div>
        </section>

        <!-- Analytics Section -->
        <section id="analytics" class="section">
            <div class="section-header">
                <h1>Analytics</h1>
                <p>Platform performance and user insights</p>
            </div>

            <div class="analytics-grid">
                <div class="chart-card">
                    <h3>User Growth</h3>
                    <div class="chart-placeholder" id="userGrowthChart">
                        <p>User growth chart visualization</p>
                    </div>
                </div>

                <div class="chart-card">
                    <h3>Book Categories</h3>
                    <div class="chart-placeholder" id="categoryChart">
                        <p>Category distribution chart</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Settings Section -->
        <section id="settings" class="section">
            <div class="section-header">
                <h1>Settings</h1>
                <p>Manage your admin preferences</p>
            </div>

            <div class="settings-grid">
                <div class="setting-card">
                    <h3>General Settings</h3>
                    <div class="setting-item">
                        <label>Platform Name</label>
                        <input type="text" value="Intelli-Read">
                    </div>
                    <div class="setting-item">
                        <label>Admin Email</label>
                        <input type="email" value="admin@intelliread.com">
                    </div>
                </div>

                <div class="setting-card">
                    <h3>Security</h3>
                    <div class="setting-item">
                        <label>Auto-logout (minutes)</label>
                        <input type="number" value="30">
                    </div>
                    <div class="setting-item">
                        <label>Enable 2FA</label>
                        <label class="switch">
                            <input type="checkbox">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
            </div>
        </section>
    </main>
</div>

<!-- Modal for user details -->
<div id="userModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>User Details</h2>
        <div id="userDetails">
            <!-- User details will be loaded here -->
        </div>
    </div>
</div>

<!-- Modal for book details -->
<div id="bookModal" class="modal">
    <div class="modal-content large">
        <span class="close">&times;</span>
        <h2>Book Details</h2>
        <div id="bookDetails">
            <!-- Book details will be loaded here -->
        </div>
    </div>
</div>

<!-- Rejection Reason Modal -->
<div id="rejectionModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Reject Book</h2>
        <form id="rejectionForm">
            <div class="form-group">
                <label for="rejectionReason">Reason for Rejection *</label>
                <textarea id="rejectionReason" required placeholder="Please provide a reason for rejecting this book..." style="width: 100%; height: 120px; padding: 10px; border: 1px solid var(--border); border-radius: 5px;"></textarea>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn-secondary" onclick="closeRejectionModal()">Cancel</button>
                <button type="submit" class="btn-danger">Reject Book</button>
            </div>
        </form>
    </div>
</div>

<script>
    // ===== GLOBAL VARIABLES =====
// Store current page states for users and books
let currentUserPage = 1;
let currentBookPage = 1;

// Define how many items to show per page
const usersPerPage = 10;
const booksPerPage = 10;

// Arrays to store all loaded users and books data
let allUsers = [];
let allBooks = [];

// Track which book is currently being rejected
let currentRejectBookId = null;

// ===== DASHBOARD INITIALIZATION =====
// This runs when the page finishes loading
document.addEventListener('DOMContentLoaded', function() {
    // Log initialization message
    console.log('ðŸ Admin Dashboard Initialized');

    // Check if user is properly logged in as admin
    checkAdminAuth();

    // Wait 1 second then load all dashboard data
    setTimeout(() => {
        console.log('ðŸ”„ Loading dashboard data...');

        // Load dashboard summary statistics
        loadDashboardSummary().catch(err => {
            console.log('ðŸ“Š Dashboard summary failed, using demo data');
            setDemoDashboardData();
        });

        // Load users list
        loadUsers().catch(err => {
            console.log('ðŸ‘¥ Users loading failed, using demo data');
            showDemoUsers();
        });

        // Load books list
        loadBooks().catch(err => {
            console.log('ðŸ“š Books loading failed, using demo data');
            showDemoBooks();
        });

    }, 1000); // Wait 1 second before loading

    // Set up all click handlers and event listeners
    setupEventListeners();
});

// ===== AUTHENTICATION FUNCTIONS =====
// Verify admin is logged in before allowing access
function checkAdminAuth() {
    // Get admin session data from browser storage
    const admin = sessionStorage.getItem('admin');

    // If no admin session found, redirect to login page
    if (!admin) {
        console.log('âŒ No admin session found, redirecting to login...');
        window.location.href = '/admin';
        return;
    }

    // Log successful authentication
    console.log('âœ… Admin authenticated');
}

// ===== NAVIGATION FUNCTIONS =====
// Switch between different sections of the dashboard
function showSection(sectionId) {
    // Hide all sections first
    const sections = document.querySelectorAll('.section');
    sections.forEach(section => {
        section.classList.remove('active');
    });

    // Remove active highlight from all menu items
    const menuItems = document.querySelectorAll('.menu-item');
    menuItems.forEach(item => {
        item.classList.remove('active');
    });

    // Show the selected section
    const targetSection = document.getElementById(sectionId);
    if (targetSection) {
        targetSection.classList.add('active');
    }

    // Highlight the clicked menu item
    const targetMenuItem = document.querySelector(`.menu-item[onclick="showSection('${sectionId}')"]`);
    if (targetMenuItem) {
        targetMenuItem.classList.add('active');
    }

    // Load data specific to the selected section
    switch(sectionId) {
        case 'dashboard':
            loadDashboardSummary();
            break;
        case 'users':
            loadUsers();
            break;
        case 'books':
            loadBooks();
            break;
        case 'analytics':
            loadAnalytics();
            break;
    }
}

// ===== DASHBOARD DATA FUNCTIONS =====
// Load summary statistics for the dashboard
async function loadDashboardSummary() {
    try {
        console.log('ðŸ“Š Loading dashboard summary...');

        // Fetch data from server API
        const response = await fetch('/api/admin/summary');

        // Check if server returned an error
        if (!response.ok) {
            console.warn('âš ï¸ Dashboard API returned error:', response.status);
            setDemoDashboardData();
            return;
        }

        // Verify response is JSON format
        const contentType = response.headers.get('content-type');
        if (!contentType || !contentType.includes('application/json')) {
            console.warn('âš ï¸ Dashboard API returned non-JSON response');
            setDemoDashboardData();
            return;
        }

        // Parse the JSON response
        const data = await response.json();

        // Update dashboard with real data if successful
        if (data.success) {
            // Update stats cards with actual numbers
            document.getElementById('totalUsers').textContent = data.totalUsers || 0;
            document.getElementById('totalBooks').textContent = data.totalBooks || 0;
            document.getElementById('pendingBooks').textContent = data.pendingBooks || 0;
            document.getElementById('activeUsers').textContent = data.activeUsers || 0;

            // Update additional stats if elements exist
            const pendingPublishersElement = document.getElementById('pendingPublishers');
            const totalPublishersElement = document.getElementById('totalPublishers');

            if (pendingPublishersElement) {
                pendingPublishersElement.textContent = data.pendingPublishers || 0;
            }
            if (totalPublishersElement) {
                totalPublishersElement.textContent = data.totalPublishers || 0;
            }

            // Load recent activity feed
            loadRecentActivity(data.recentActivity);
        } else {
            console.error('Error loading dashboard summary:', data.message);
            setDemoDashboardData();
        }
    } catch (error) {
        console.error('Error loading dashboard summary:', error);
        setDemoDashboardData();
    }
}

// Set demo data when real data fails to load
function setDemoDashboardData() {
    document.getElementById('totalUsers').textContent = '1,254';
    document.getElementById('totalBooks').textContent = '567';
    document.getElementById('pendingBooks').textContent = '23';
    document.getElementById('activeUsers').textContent = '189';
    document.getElementById('pendingPublishers').textContent = '5';
    document.getElementById('totalPublishers').textContent = '47';
}

// Load recent activity feed
async function loadRecentActivity(activities = null) {
    try {
        const activityList = document.getElementById('recentActivity');
        if (!activityList) return;

        // If no activities provided, fetch from server
        if (!activities) {
            const response = await fetch('/api/admin/activities');
            if (response.ok) {
                const data = await response.json();
                if (data.success) {
                    activities = data.activities;
                }
            }
        }

        // Use demo data if no activities from API
        if (!activities || activities.length === 0) {
            activities = [
                {
                    type: 'user',
                    message: 'New user registration',
                    time: 'Just now',
                    icon: 'bx-user-plus'
                },
                {
                    type: 'book',
                    message: 'New book pending approval',
                    time: '5 minutes ago',
                    icon: 'bx-book-add'
                },
                {
                    type: 'system',
                    message: 'Publisher account approved',
                    time: '1 hour ago',
                    icon: 'bx-user-check'
                }
            ];
        }

        // Clear existing activities
        activityList.innerHTML = '';

        // Create HTML for each activity item
        activities.forEach(activity => {
            const activityItem = document.createElement('div');
            activityItem.className = 'activity-item';

            activityItem.innerHTML = `
                <div class="activity-icon ${activity.type}">
                    <i class='bx ${activity.icon}'></i>
                </div>
                <div class="activity-info">
                    <p>${activity.message}</p>
                    <span>${activity.time}</span>
                </div>
            `;

            activityList.appendChild(activityItem);
        });
    } catch (error) {
        console.error('Error loading recent activity:', error);
    }
}

// ===== USER MANAGEMENT FUNCTIONS =====
// Load users with pagination
async function loadUsers(page = 1) {
    try {
        // Update current page
        currentUserPage = page;

        // Show loading state in table
        const userTableBody = document.getElementById('userTableBody');
        userTableBody.innerHTML = `
            <tr>
                <td colspan="6" class="loading-cell">
                    <div class="loading-spinner"></div>
                    Loading users...
                </td>
            </tr>
        `;

        console.log('ðŸ‘¥ Loading users...');

        // Fetch users from server API
        const response = await fetch(`/api/admin/users?page=${page}&limit=${usersPerPage}`);

        // Check for HTTP errors
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        // Verify response is JSON format
        const contentType = response.headers.get('content-type');
        if (!contentType || !contentType.includes('application/json')) {
            throw new Error('API returned non-JSON response');
        }

        // Parse JSON response
        const data = await response.json();

        // Process successful response
        if (data.success) {
            // Store users globally
            allUsers = data.users;

            // Clear table body
            userTableBody.innerHTML = '';

            // Show message if no users found
            if (data.users.length === 0) {
                userTableBody.innerHTML = `
                    <tr>
                        <td colspan="6" class="no-data">
                            <i class='bx bx-user-x'></i>
                            <p>No users found</p>
                        </td>
                    </tr>
                `;
                return;
            }

            // Create table row for each user
            data.users.forEach(user => {
                const row = document.createElement('tr');

                // Determine user status and badge styling
                let statusText, statusClass;
                if (user.role === 'publisher') {
                    if (user.isApproved) {
                        statusText = 'Approved Publisher';
                        statusClass = 'status-approved';
                    } else {
                        statusText = 'Pending Approval';
                        statusClass = 'status-pending';
                    }
                } else {
                    statusText = user.isActive !== false ? 'Active User' : 'Inactive';
                    statusClass = user.isActive !== false ? 'status-active' : 'status-inactive';
                }

                // Create HTML for user row
                row.innerHTML = `
                    <td>
                        <div class="user-avatar">
                            <i class='bx bx-user'></i>
                            <span>${user.fullName || 'Unknown User'}</span>
                        </div>
                    </td>
                    <td>${user.email || 'No email'}</td>
                    <td>
                        <span class="role-badge ${user.role}">${user.role || 'user'}</span>
                    </td>
                    <td>
                        <span class="status-badge ${statusClass}">${statusText}</span>
                    </td>
                    <td>${user.createdAt ? formatDate(user.createdAt) : 'Unknown'}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-info" onclick="viewUser('${user._id}')" title="View Details">
                                <i class='bx bx-show'></i> View
                            </button>
                            ${user.role === 'publisher' && !user.isApproved ?
                                `<button class="btn-success" onclick="approvePublisher('${user._id}')" title="Approve Publisher">
                                    <i class='bx bx-check'></i> Approve
                                </button>
                                 <button class="btn-danger" onclick="rejectPublisher('${user._id}')" title="Reject Publisher">
                                    <i class='bx bx-x'></i> Reject
                                 </button>` :
                                `<button class="btn-danger" onclick="deleteUser('${user._id}')" title="Delete User">
                                    <i class='bx bx-trash'></i> Delete
                                 </button>`
                            }
                        </div>
                    </td>
                `;

                // Add row to table
                userTableBody.appendChild(row);
            });

            // Update pagination controls
            updateUserPagination(data.totalPages, page);
        } else {
            console.error('Error loading users:', data.message);
            showNotification('Error loading users: ' + data.message, 'error');
        }
    } catch (error) {
        console.error('Error loading users:', error);
        showNotification('Network error loading users: ' + error.message, 'error');
    }
}

// Update pagination controls for users table
function updateUserPagination(totalPages, currentPage) {
    const pagination = document.getElementById('userPagination');
    if (!pagination) return;

    let paginationHTML = '';

    // Previous button
    if (currentPage > 1) {
        paginationHTML += `<button class="page-btn" onclick="loadUsers(${currentPage - 1})">Previous</button>`;
    }

    // Page number buttons
    for (let i = 1; i <= totalPages; i++) {
        if (i === currentPage) {
            paginationHTML += `<button class="page-btn active">${i}</button>`;
        } else {
            paginationHTML += `<button class="page-btn" onclick="loadUsers(${i})">${i}</button>`;
        }
    }

    // Next button
    if (currentPage < totalPages) {
        paginationHTML += `<button class="page-btn" onclick="loadUsers(${currentPage + 1})">Next</button>`;
    }

    // Update pagination HTML
    pagination.innerHTML = paginationHTML;
}

// ===== PUBLISHER APPROVAL FUNCTIONS =====
// Approve a publisher account
async function approvePublisher(userId) {
    // Confirm action with user
    if (confirm('Are you sure you want to approve this publisher?')) {
        try {
            // Show loading notification
            showNotification('Approving publisher...', 'info');

            // Send approval request to server
            const response = await fetch(`/api/admin/publishers/${userId}/approve`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                }
            });

            // Parse response
            const data = await response.json();

            // Handle response
            if (data.success) {
                showNotification('Publisher approved successfully!', 'success');
                // Refresh data
                loadUsers(currentUserPage);
                loadDashboardSummary();
            } else {
                showNotification('Error: ' + data.message, 'error');
            }
        } catch (error) {
            console.error('Error approving publisher:', error);
            showNotification('Error approving publisher', 'error');
        }
    }
}

// Reject a publisher account
async function rejectPublisher(userId) {
    // Show strong warning confirmation
    if (confirm('âš ï¸ ARE YOU SURE YOU WANT TO REJECT THIS PUBLISHER?\n\nThis will:\nâ€¢ Permanently delete the publisher account\nâ€¢ Delete ALL books uploaded by this publisher\nâ€¢ This action cannot be undone!')) {
        try {
            showNotification('Rejecting publisher and deleting all data...', 'warning');

            // Send rejection request to server
            const response = await fetch(`/api/admin/publishers/${userId}/reject`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                }
            });

            // Parse response
            const data = await response.json();

            // Handle response
            if (data.success) {
                showNotification('âœ… Publisher rejected and all data permanently deleted!', 'success');
                // Refresh data
                loadUsers(currentUserPage);
                loadDashboardSummary();
            } else {
                showNotification('âŒ Error: ' + data.message, 'error');
            }
        } catch (error) {
            console.error('Error rejecting publisher:', error);
            showNotification('âŒ Error rejecting publisher', 'error');
        }
    }
}

// ===== USER ACTIONS =====
// View detailed user information
async function viewUser(userId) {
    try {
        // Fetch user details from server
        const response = await fetch(`/api/admin/users/${userId}`);

        // Check for HTTP errors
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        // Parse response
        const data = await response.json();

        // Show user modal if successful
        if (data.success) {
            showUserModal(data.user);
        } else {
            console.error('Error loading user details:', data.message);
            showNotification('Error loading user details: ' + data.message, 'error');
        }
    } catch (error) {
        console.error('Error viewing user:', error);

        // Fallback: try to find user in loaded data
        const user = allUsers.find(u => u._id === userId);
        if (user) {
            showUserModal(user);
        } else {
            showNotification('Error loading user details. Please try again.', 'error');
        }
    }
}

// Display user details in modal
function showUserModal(user) {
    const modal = document.getElementById('userModal');
    const userDetails = document.getElementById('userDetails');

    if (modal && userDetails) {
        // Format dates for display
        const joinDate = user.createdAt ? formatDateTime(user.createdAt) : 'Unknown';
        const lastLogin = user.lastLogin ? formatDateTime(user.lastLogin) : 'Never';

        // Create user details HTML
        userDetails.innerHTML = `
            <div class="user-detail-grid">
                <div class="user-detail">
                    <label>Full Name:</label>
                    <span>${user.fullName || 'N/A'}</span>
                </div>
                <div class="user-detail">
                    <label>Email:</label>
                    <span>${user.email || 'N/A'}</span>
                </div>
                <div class="user-detail">
                    <label>Role:</label>
                    <span class="role-badge ${user.role || 'user'}">${user.role || 'User'}</span>
                </div>
                <div class="user-detail">
                    <label>Status:</label>
                    <span class="status-badge ${getUserStatusClass(user)}">
                        ${getUserStatusText(user)}
                    </span>
                </div>
                <div class="user-detail">
                    <label>Account Created:</label>
                    <span>${joinDate}</span>
                </div>
                <div class="user-detail">
                    <label>Last Login:</label>
                    <span>${lastLogin}</span>
                </div>
                ${user.role === 'publisher' ? `
                <div class="user-detail">
                    <label>Publisher Status:</label>
                    <span class="status-badge ${user.isApproved ? 'status-approved' : 'status-pending'}">
                        ${user.isApproved ? 'Approved' : 'Pending Approval'}
                    </span>
                </div>
                ${user.publisherSince ? `
                <div class="user-detail">
                    <label>Publisher Since:</label>
                    <span>${formatDateTime(user.publisherSince)}</span>
                </div>
                ` : ''}
                ` : ''}
                ${user.booksPublished >= 0 ? `
                <div class="user-detail">
                    <label>Books Published:</label>
                    <span>${user.booksPublished}</span>
                </div>
                ` : ''}
            </div>
            <div class="modal-actions">
                ${user.role === 'publisher' && !user.isApproved ? `
                    <button class="btn-success" onclick="approvePublisher('${user._id}')">
                        <i class='bx bx-check'></i> Approve Publisher
                    </button>
                    <button class="btn-danger" onclick="rejectPublisher('${user._id}')">
                        <i class='bx bx-x'></i> Reject Publisher
                    </button>
                ` : `
                    <button class="btn-primary" onclick="editUser('${user._id}')">
                        <i class='bx bx-edit'></i> Edit User
                    </button>
                `}
                <button class="btn-danger" onclick="deleteUser('${user._id}')">
                    <i class='bx bx-trash'></i> Delete User
                </button>
            </div>
        `;

        // Show the modal
        modal.style.display = 'block';
    } else {
        console.error('Modal elements not found');
        showNotification('Error: Could not open user details', 'error');
    }
}

// Helper function to get CSS class for user status
function getUserStatusClass(user) {
    if (user.role === 'publisher') {
        return user.isApproved ? 'status-approved' : 'status-pending';
    }
    return user.isActive !== false ? 'status-active' : 'status-inactive';
}

// Helper function to get display text for user status
function getUserStatusText(user) {
    if (user.role === 'publisher') {
        return user.isApproved ? 'Approved Publisher' : 'Pending Publisher';
    }
    return user.isActive !== false ? 'Active User' : 'Inactive User';
}

// Edit user (placeholder function)
async function editUser(userId) {
    showNotification('Edit user functionality coming soon!', 'info');
}

// Delete user permanently
async function deleteUser(userId) {
    // Find user in loaded data
    const user = allUsers.find(u => u._id == userId);
    if (!user) return;

    // Show strong warning confirmation
    if (confirm(`âš ï¸ ARE YOU SURE YOU WANT TO PERMANENTLY DELETE USER "${user.fullName}"?\n\nThis will:\nâ€¢ Delete user account permanently\nâ€¢ Delete all user data\nâ€¢ This action cannot be undone!`)) {
        try {
            showNotification('Deleting user...', 'warning');

            // Send delete request to server
            const response = await fetch(`/api/admin/users/${userId}`, {
                method: 'DELETE'
            });

            // Parse response
            const data = await response.json();

            // Handle response
            if (data.success) {
                showNotification('âœ… User permanently deleted from database!', 'success');
                // Refresh data
                loadUsers(currentUserPage);
                loadDashboardSummary();
                // Close modal if open
                document.getElementById('userModal').style.display = 'none';
            } else {
                showNotification('âŒ Error: ' + data.message, 'error');
            }
        } catch (error) {
            console.error('Error deleting user:', error);
            showNotification('âŒ Error deleting user', 'error');
        }
    }
}

// ===== BOOK MANAGEMENT FUNCTIONS =====
// Load books with pagination
async function loadBooks(page = 1) {
    try {
        // Update current page
        currentBookPage = page;

        // Show loading state in table
        const bookTableBody = document.getElementById('bookTableBody');
        bookTableBody.innerHTML = `
            <tr>
                <td colspan="7" class="loading-cell">
                    <div class="loading-spinner"></div>
                    Loading books...
                </td>
            </tr>
        `;

        console.log('ðŸ“š Loading books...');

        // Fetch books from server API
        const response = await fetch(`/api/admin/books?page=${page}&limit=${booksPerPage}&status=all`);

        // Check for HTTP errors
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        // Verify response is JSON format
        const contentType = response.headers.get('content-type');
        if (!contentType || !contentType.includes('application/json')) {
            throw new Error('API returned non-JSON response');
        }

        // Parse JSON response
        const data = await response.json();

        // Process successful response
        if (data.success) {
            // Store books globally
            allBooks = data.books;

            // Clear table body
            bookTableBody.innerHTML = '';

            // Show message if no books found
            if (data.books.length === 0) {
                bookTableBody.innerHTML = `
                    <tr>
                        <td colspan="7" class="no-data">
                            <i class='bx bx-book-open'></i>
                            <p>No books found</p>
                        </td>
                    </tr>
                `;
                return;
            }

            // Create table row for each book
            data.books.forEach(book => {
                const row = document.createElement('tr');

                // Determine book status and badge styling
                let statusClass = '';
                let statusText = book.status ? book.status.charAt(0).toUpperCase() + book.status.slice(1) : 'Unknown';
                switch(book.status) {
                    case 'approved':
                        statusClass = 'status-approved';
                        break;
                    case 'pending':
                        statusClass = 'status-pending';
                        break;
                    case 'rejected':
                        statusClass = 'status-rejected';
                        break;
                    default:
                        statusClass = 'status-pending';
                }

                // Create HTML for book row
                row.innerHTML = `
                    <td>
                        ${book.coverImage ?
                            `<img src="${book.coverImage}" alt="${book.title}" class="book-cover">` :
                            '<div class="book-cover-placeholder"><i class="bx bx-book"></i></div>'
                        }
                    </td>
                    <td>
                        <div class="book-title">
                            <strong>${book.title || 'Untitled'}</strong>
                            <div style="font-size: 0.8rem; color: var(--gray); margin-top: 4px;">
                                by ${book.author || 'Unknown Author'}
                            </div>
                        </div>
                    </td>
                    <td>
                        <span class="category-tag">${book.category || 'Uncategorized'}</span>
                    </td>
                    <td>
                        <div style="font-size: 0.9rem;">
                            ${book.publisherName || 'Unknown Publisher'}
                        </div>
                    </td>
                    <td>
                        <span class="status-badge ${statusClass}">${statusText}</span>
                    </td>
                    <td>${book.createdAt ? formatDate(book.createdAt) : 'Unknown'}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-info" onclick="viewBook('${book._id}')" title="View Details">
                                <i class='bx bx-show'></i> View
                            </button>
                            ${book.status === 'pending' ?
                                `<button class="btn-success" onclick="approveBook('${book._id}')" title="Approve Book">
                                    <i class='bx bx-check'></i> Approve
                                </button>
                                 <button class="btn-danger" onclick="showRejectionModal('${book._id}')" title="Reject Book">
                                    <i class='bx bx-x'></i> Reject
                                 </button>` :
                                `<button class="btn-warning" onclick="editBook('${book._id}')" title="Edit Book">
                                    <i class='bx bx-edit'></i> Edit
                                </button>`
                            }
                            <button class="btn-danger" onclick="deleteBook('${book._id}')" title="Delete Book">
                                <i class='bx bx-trash'></i> Delete
                            </button>
                        </div>
                    </td>
                `;

                // Add row to table
                bookTableBody.appendChild(row);
            });

            // Update pagination controls
            updateBookPagination(data.totalPages, page);
        } else {
            console.error('Error loading books:', data.message);
            showNotification('Error loading books: ' + data.message, 'error');
        }
    } catch (error) {
        console.error('Error loading books:', error);
        showNotification('Network error loading books: ' + error.message, 'error');
    }
}

// Update pagination controls for books table
function updateBookPagination(totalPages, currentPage) {
    const pagination = document.getElementById('bookPagination');
    if (!pagination) return;

    let paginationHTML = '';

    // Previous button
    if (currentPage > 1) {
        paginationHTML += `<button class="page-btn" onclick="loadBooks(${currentPage - 1})">Previous</button>`;
    }

    // Page number buttons
    for (let i = 1; i <= totalPages; i++) {
        if (i === currentPage) {
            paginationHTML += `<button class="page-btn active">${i}</button>`;
        } else {
            paginationHTML += `<button class="page-btn" onclick="loadBooks(${i})">${i}</button>`;
        }
    }

    // Next button
    if (currentPage < totalPages) {
        paginationHTML += `<button class="page-btn" onclick="loadBooks(${currentPage + 1})">Next</button>`;
    }

    // Update pagination HTML
    pagination.innerHTML = paginationHTML;
}

// ===== BOOK ACTIONS =====
// Approve a book for publishing
async function approveBook(bookId) {
    // Confirm action with user
    if (confirm('Are you sure you want to approve this book?')) {
        try {
            showNotification('Approving book...', 'info');

            // Send approval request to server
            const response = await fetch(`/api/admin/books/${bookId}/approve`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                }
            });

            // Parse response
            const data = await response.json();

            // Handle response
            if (data.success) {
                showNotification('Book approved successfully!', 'success');
                // Refresh data
                loadBooks(currentBookPage);
                loadDashboardSummary();
                // Close modal if open
                document.getElementById('bookModal').style.display = 'none';
            } else {
                showNotification('Error: ' + data.message, 'error');
            }
        } catch (error) {
            console.error('Error approving book:', error);
            showNotification('Error approving book', 'error');
        }
    }
}

// Show rejection reason modal
function showRejectionModal(bookId) {
    // Store book ID for later use
    currentRejectBookId = bookId;
    const modal = document.getElementById('rejectionModal');
    if (modal) {
        // Show modal and clear previous reason
        modal.style.display = 'block';
        document.getElementById('rejectionReason').value = '';
    }
}

// Close rejection modal
function closeRejectionModal() {
    const modal = document.getElementById('rejectionModal');
    if (modal) {
        // Hide modal and clear stored book ID
        modal.style.display = 'none';
        currentRejectBookId = null;
    }
}

// Handle rejection form submission
document.getElementById('rejectionForm').addEventListener('submit', async function(e) {
    // Prevent default form submission
    e.preventDefault();

    // Check if we have a book to reject
    if (!currentRejectBookId) return;

    // Get rejection reason
    const reason = document.getElementById('rejectionReason').value;

    // Validate reason is provided
    if (!reason.trim()) {
        showNotification('Please provide a reason for rejection', 'error');
        return;
    }

    // Final confirmation before permanent deletion
    if (confirm(`âš ï¸ FINAL CONFIRMATION:\n\nAre you absolutely sure you want to REJECT and PERMANENTLY DELETE this book?\n\nReason: ${reason}\n\nThis action cannot be undone!`)) {
        await rejectBook(currentRejectBookId, reason);
    }
});

// Reject and delete a book
async function rejectBook(bookId, reason) {
    // Confirm action with user
    if (confirm('Are you sure you want to REJECT and PERMANENTLY DELETE this book from database? This action cannot be undone!')) {
        try {
            showNotification('Rejecting and deleting book...', 'warning');

            // Send rejection request to server
            const response = await fetch(`/api/admin/books/${bookId}/reject`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ reason: reason })
            });

            // Parse response
            const data = await response.json();

            // Handle response
            if (data.success) {
                showNotification('âœ… Book rejected and permanently deleted from database!', 'success');
                // Refresh data
                loadBooks(currentBookPage);
                loadDashboardSummary();
                // Close rejection modal
                closeRejectionModal();
            } else {
                showNotification('âŒ Error: ' + data.message, 'error');
            }
        } catch (error) {
            console.error('Error rejecting book:', error);
            showNotification('âŒ Error rejecting book', 'error');
        }
    }
}

// View detailed book information
async function viewBook(bookId) {
    try {
        // Fetch book details from server
        const response = await fetch(`/api/admin/books/${bookId}`);

        // Check for HTTP errors
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        // Parse response
        const data = await response.json();

        // Show book modal if successful
        if (data.success) {
            showBookModal(data.book);
        } else {
            console.error('Error loading book details:', data.message);
            showNotification('Error loading book details: ' + data.message, 'error');
        }
    } catch (error) {
        console.error('Error viewing book:', error);

        // Fallback: try to find book in loaded data
        const book = allBooks.find(b => b._id === bookId);
        if (book) {
            showBookModal(book);
        } else {
            showNotification('Error loading book details. Please try again.', 'error');
        }
    }
}

// Display book details in modal
function showBookModal(book) {
    const modal = document.getElementById('bookModal');
    const bookDetails = document.getElementById('bookDetails');

    if (modal && bookDetails) {
        // Format status for display
        const statusText = book.status ? book.status.charAt(0).toUpperCase() + book.status.slice(1) : 'Unknown';
        const statusClass = book.status ? `status-${book.status}` : 'status-pending';

        // Create book details HTML
        bookDetails.innerHTML = `
            <div class="book-detail-grid">
                <div class="book-cover-large">
                    ${book.coverImage ?
                        `<img src="${book.coverImage}" alt="${book.title}" style="max-width: 200px; border-radius: 8px;">` :
                        '<div class="book-cover-placeholder" style="width: 200px; height: 300px; background: #f8f9fa; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #6c757d; font-size: 3rem;"><i class="bx bx-book"></i></div>'
                    }
                </div>
                <div class="book-info">
                    <h3>${book.title || 'Untitled'}</h3>
                    <p class="book-author">by ${book.author || 'Unknown Author'}</p>

                    <div class="book-meta">
                        <span class="category-tag">${book.category || 'Uncategorized'}</span>
                        <span class="status-badge ${statusClass}">
                            ${statusText}
                        </span>
                        ${book.isFeatured ? '<span class="featured-badge">Featured</span>' : ''}
                    </div>

                    <div style="margin: 1rem 0; padding: 1rem; background: #f8f9fa; border-radius: 6px;">
                        <strong>Publisher:</strong> ${book.publisherName || 'Unknown'}
                    </div>

                    ${book.description ? `
                    <div class="book-description">
                        <h4>Description</h4>
                        <p>${book.description}</p>
                    </div>
                    ` : ''}

                    <div class="book-stats">
                        <div class="stat">
                            <label>Language:</label>
                            <span>${book.language || 'English'}</span>
                        </div>
                        <div class="stat">
                            <label>Submitted:</label>
                            <span>${book.createdAt ? formatDateTime(book.createdAt) : 'Unknown'}</span>
                        </div>
                        ${book.reviewedAt ? `
                        <div class="stat">
                            <label>Reviewed:</label>
                            <span>${formatDateTime(book.reviewedAt)}</span>
                        </div>
                        ` : ''}
                        ${book.adminNotes ? `
                        <div class="stat">
                            <label>Admin Notes:</label>
                            <span style="color: var(--warning);">${book.adminNotes}</span>
                        </div>
                        ` : ''}
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                ${book.status === 'pending' ? `
                    <button class="btn-success" onclick="approveBook('${book._id}')">
                        <i class='bx bx-check'></i> Approve
                    </button>
                    <button class="btn-danger" onclick="showRejectionModal('${book._id}')">
                        <i class='bx bx-x'></i> Reject
                    </button>
                ` : ''}
                <button class="btn-primary" onclick="editBook('${book._id}')">
                    <i class='bx bx-edit'></i> Edit
                </button>
                ${book.isFeatured ? `
                    <button class="btn-secondary" onclick="unfeatureBook('${book._id}')">
                        <i class='bx bx-star'></i> Unfeature
                    </button>
                ` : `
                    <button class="btn-success" onclick="featureBook('${book._id}')">
                        <i class='bx bx-star'></i> Feature
                    </button>
                `}
                <button class="btn-danger" onclick="deleteBook('${book._id}')">
                    <i class='bx bx-trash'></i> Delete
                </button>
            </div>
        `;

        // Show the modal
        modal.style.display = 'block';
    }
}

// Edit book (placeholder function)
async function editBook(bookId) {
    showNotification('Edit book functionality coming soon!', 'info');
}

// Feature book (placeholder function)
async function featureBook(bookId) {
    showNotification('Feature book functionality coming soon!', 'info');
}

// Unfeature book (placeholder function)
async function unfeatureBook(bookId) {
    showNotification('Unfeature book functionality coming soon!', 'info');
}

// Delete book permanently
async function deleteBook(bookId) {
    // Find book in loaded data
    const book = allBooks.find(b => b._id == bookId);
    if (!book) return;

    // Show strong warning confirmation
    if (confirm(`âš ï¸ ARE YOU SURE YOU WANT TO PERMANENTLY DELETE BOOK "${book.title}"?\n\nThis will:\nâ€¢ Delete book permanently from database\nâ€¢ Remove all book data\nâ€¢ This action cannot be undone!`)) {
        try {
            showNotification('Deleting book...', 'warning');

            // Send delete request to server
            const response = await fetch(`/api/admin/books/${bookId}`, {
                method: 'DELETE'
            });

            // Parse response
            const data = await response.json();

            // Handle response
            if (data.success) {
                showNotification('âœ… Book permanently deleted from database!', 'success');
                // Refresh data
                loadBooks(currentBookPage);
                loadDashboardSummary();
                // Close modal if open
                const modal = document.getElementById('bookModal');
                if (modal) modal.style.display = 'none';
            } else {
                showNotification('âŒ Error: ' + data.message, 'error');
            }
        } catch (error) {
            console.error('Error deleting book:', error);
            showNotification('âŒ Error deleting book', 'error');
        }
    }
}

// ===== SEARCH AND FILTER FUNCTIONS =====
// Search through users table
function searchUsers() {
    // Get search term and convert to lowercase
    const searchTerm = document.getElementById('userSearch').value.toLowerCase();

    // Get all user table rows
    const rows = document.querySelectorAll('#userTableBody tr');

    // Show/hide rows based on search match
    rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(searchTerm) ? '' : 'none';
    });
}

// Search through books table
function searchBooks() {
    // Get search term and convert to lowercase
    const searchTerm = document.getElementById('bookSearch').value.toLowerCase();

    // Get all book table rows
    const rows = document.querySelectorAll('#bookTableBody tr');

    // Show/hide rows based on search match
    rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(searchTerm) ? '' : 'none';
    });
}

// Filter books by status
function filterBooks() {
    // Get selected status filter
    const statusFilter = document.getElementById('statusFilter').value;

    // Get all book table rows
    const rows = document.querySelectorAll('#bookTableBody tr');

    // Show/hide rows based on status filter
    rows.forEach(row => {
        // Show all if no filter selected
        if (!statusFilter) {
            row.style.display = '';
            return;
        }

        // Find status badge in row
        const statusBadge = row.querySelector('.status-badge');

        // Show row if status matches filter
        if (statusBadge && statusBadge.textContent.toLowerCase() === statusFilter.toLowerCase()) {
            row.style.display = '';
        } else {
            row.style.display = 'none';
        }
    });
}

// ===== ANALYTICS FUNCTIONS =====
// Load analytics data
async function loadAnalytics() {
    try {
        // Fetch analytics data from server
        const response = await fetch('/api/admin/analytics');

        // Process successful response
        if (response.ok) {
            const data = await response.json();
            if (data.success) {
                // Update analytics charts here
                console.log('Analytics data loaded:', data);
            }
        }
    } catch (error) {
        console.error('Error loading analytics:', error);
    }
}

// ===== EXPORT FUNCTIONALITY =====
// Export users to CSV file
async function exportUsers() {
    try {
        showNotification('Preparing user export...', 'info');

        // Fetch all users for export
        const response = await fetch('/api/admin/users?limit=1000');
        const data = await response.json();

        // Process successful response
        if (data.success) {
            // Convert user data to CSV format
            const csv = convertToCSV(data.users);

            // Download the CSV file
            downloadCSV(csv, 'intelliread-users.csv');

            showNotification('Users exported successfully!', 'success');
        } else {
            showNotification('Error exporting users: ' + data.message, 'error');
        }
    } catch (error) {
        console.error('Error exporting users:', error);
        showNotification('Error exporting users', 'error');
    }
}

// Convert user data to CSV format
function convertToCSV(users) {
    // Define CSV column headers
    const headers = ['Name', 'Email', 'Role', 'Status', 'Joined Date'];

    // Convert each user to a CSV row
    const rows = users.map(user => [
        user.fullName,
        user.email,
        user.role,
        user.role === 'publisher' ? (user.isApproved ? 'Approved Publisher' : 'Pending Approval') : 'Active User',
        new Date(user.createdAt).toLocaleDateString()
    ]);

    // Combine headers and rows into CSV string
    return [headers, ...rows].map(row => row.map(field => `"${field}"`).join(',')).join('\n');
}

// Download CSV file
function downloadCSV(csv, filename) {
    // Create file blob
    const blob = new Blob([csv], { type: 'text/csv' });

    // Create download URL
    const url = window.URL.createObjectURL(blob);

    // Create invisible download link
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;

    // Trigger download
    a.click();

    // Clean up URL
    window.URL.revokeObjectURL(url);
}

// ===== SETTINGS FUNCTIONS =====
// Save settings (placeholder function)
function saveSettings() {
    showNotification('Settings saved successfully!', 'success');
}

// ===== LOGOUT FUNCTIONALITY =====
// Log out admin user
async function logout() {
    // Confirm logout action
    const confirmLogout = confirm('Are you sure you want to logout? You will need to login again to access the admin dashboard.');

    if (confirmLogout) {
        try {
            showNotification('Logging out... Please wait.', 'info');

            // Send logout request to server
            const response = await fetch('/admin/logout', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            });

            // Parse response
            const data = await response.json();

            // Clear session storage
            sessionStorage.removeItem('admin');
            sessionStorage.removeItem('isAdmin');

            console.log('âœ… Admin logged out successfully');

            // Handle response
            if (data.success) {
                showNotification('Logout successful! Redirecting to login page...', 'success');

                // Redirect to admin login page after delay
                setTimeout(() => {
                    window.location.href = '/admin-login';
                }, 2000);
            } else {
                showNotification('Logout failed: ' + data.message, 'error');
            }

        } catch (error) {
            console.error('Logout error:', error);

            // Clear storage even if error occurs
            sessionStorage.removeItem('admin');
            sessionStorage.removeItem('isAdmin');

            showNotification('Logout successful! Redirecting to login page...', 'success');

            // Redirect to admin login page
            setTimeout(() => {
                window.location.href = '/admin-login';
            }, 2000);
        }
    }
}

// ===== NOTIFICATION SYSTEM =====
// Show notification message to user
function showNotification(message, type = 'info') {
    // Remove any existing notifications first
    const existingNotifications = document.querySelectorAll('.notification');
    existingNotifications.forEach(notification => {
        if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
        }
    });

    // Create new notification element
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.innerHTML = `
        <div class="notification-content">
            <i class='bx ${getNotificationIcon(type)}'></i>
            <span>${message}</span>
        </div>
    `;

    // Add notification to page
    document.body.appendChild(notification);

    // Animate notification in
    setTimeout(() => {
        notification.classList.add('show');
    }, 100);

    // Auto-remove notification after 5 seconds
    setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }, 300);
    }, 5000);
}

// Get appropriate icon for notification type
function getNotificationIcon(type) {
    // Define icons for each notification type
    const icons = {
        'success': 'bx-check-circle',
        'error': 'bx-error-circle',
        'warning': 'bx-error',
        'info': 'bx-info-circle'
    };

    // Return icon or default info icon
    return icons[type] || 'bx-info-circle';
}

// ===== EVENT LISTENERS SETUP =====
// Set up all event listeners for the application
function setupEventListeners() {
    // Close modals when clicking X button
    const closeButtons = document.querySelectorAll('.close');
    closeButtons.forEach(button => {
        button.addEventListener('click', function() {
            const modal = this.closest('.modal');
            if (modal) {
                modal.style.display = 'none';
            }
        });
    });

    // Close modals when clicking outside modal content
    window.addEventListener('click', function(event) {
        const modals = document.querySelectorAll('.modal');
        modals.forEach(modal => {
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        });
    });

    // Search debouncing for better performance
    let searchTimeout;
    const userSearch = document.getElementById('userSearch');
    const bookSearch = document.getElementById('bookSearch');

    // Add debounced search for users
    if (userSearch) {
        userSearch.addEventListener('input', function() {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(searchUsers, 300);
        });
    }

    // Add debounced search for books
    if (bookSearch) {
        bookSearch.addEventListener('input', function() {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(searchBooks, 300);
        });
    }
}

// ===== UTILITY FUNCTIONS =====
// Format date to readable string (e.g., "Jan 1, 2023")
function formatDate(dateString) {
    // Return 'Unknown' if no date provided
    if (!dateString) return 'Unknown';

    // Format date using browser locale
    return new Date(dateString).toLocaleDateString('en-US', {
        year: 'numeric',
        month: 'short',
        day: 'numeric'
    });
}

// Format date and time to readable string (e.g., "Jan 1, 2023, 2:30 PM")
function formatDateTime(dateString) {
    // Return 'Unknown' if no date provided
    if (!dateString) return 'Unknown';

    // Format date and time using browser locale
    return new Date(dateString).toLocaleString('en-US', {
        year: 'numeric',
        month: 'short',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
    });
}

// ===== GLOBAL FUNCTION EXPORTS =====
// Make functions available globally for HTML onclick attributes
window.showSection = showSection;
window.loadUsers = loadUsers;
window.loadBooks = loadBooks;
window.searchUsers = searchUsers;
window.searchBooks = searchBooks;
window.filterBooks = filterBooks;
window.approvePublisher = approvePublisher;
window.rejectPublisher = rejectPublisher;
window.viewUser = viewUser;
window.editUser = editUser;
window.deleteUser = deleteUser;
window.approveBook = approveBook;
window.showRejectionModal = showRejectionModal;
window.closeRejectionModal = closeRejectionModal;
window.rejectBook = rejectBook;
window.viewBook = viewBook;
window.editBook = editBook;
window.featureBook = featureBook;
window.unfeatureBook = unfeatureBook;
window.deleteBook = deleteBook;
window.exportUsers = exportUsers;
window.saveSettings = saveSettings;
window.logout = logout;
</script>
</body>
</html>